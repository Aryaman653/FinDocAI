"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/documents/upload";
exports.ids = ["pages/api/documents/upload"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "tesseract.js":
/*!*******************************!*\
  !*** external "tesseract.js" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("tesseract.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "@google/generative-ai":
/*!****************************************!*\
  !*** external "@google/generative-ai" ***!
  \****************************************/
/***/ ((module) => {

module.exports = import("@google/generative-ai");;

/***/ }),

/***/ "formidable":
/*!*****************************!*\
  !*** external "formidable" ***!
  \*****************************/
/***/ ((module) => {

module.exports = import("formidable");;

/***/ }),

/***/ "zod":
/*!**********************!*\
  !*** external "zod" ***!
  \**********************/
/***/ ((module) => {

module.exports = import("zod");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdocuments%2Fupload&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fdocuments%2Fupload.ts&middlewareConfigBase64=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdocuments%2Fupload&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fdocuments%2Fupload.ts&middlewareConfigBase64=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _src_pages_api_documents_upload_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/pages/api/documents/upload.ts */ \"(api)/./src/pages/api/documents/upload.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_pages_api_documents_upload_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_src_pages_api_documents_upload_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_documents_upload_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_src_pages_api_documents_upload_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/documents/upload\",\n        pathname: \"/api/documents/upload\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _src_pages_api_documents_upload_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmRvY3VtZW50cyUyRnVwbG9hZCZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnNyYyUyRnBhZ2VzJTJGYXBpJTJGZG9jdW1lbnRzJTJGdXBsb2FkLnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ2dFO0FBQ2hFO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQywrREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsK0RBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmluYW5jaWFsLWRvYy1pbnRlbGxpZ2VuY2UvP2NiMDIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3NyYy9wYWdlcy9hcGkvZG9jdW1lbnRzL3VwbG9hZC50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2RvY3VtZW50cy91cGxvYWRcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9kb2N1bWVudHMvdXBsb2FkXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdocuments%2Fupload&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fdocuments%2Fupload.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./src/lib/prisma.ts":
/*!***************************!*\
  !*** ./src/lib/prisma.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst prisma = global.prisma || new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) {\n    global.prisma = prisma;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL3ByaXNtYS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBOEM7QUFNdkMsTUFBTUMsU0FBU0MsT0FBT0QsTUFBTSxJQUFJLElBQUlELHdEQUFZQSxHQUFHO0FBRTFELElBQUlHLElBQXlCLEVBQWM7SUFDekNELE9BQU9ELE1BQU0sR0FBR0E7QUFDbEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9maW5hbmNpYWwtZG9jLWludGVsbGlnZW5jZS8uL3NyYy9saWIvcHJpc21hLnRzPzAxZDciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnO1xuXG5kZWNsYXJlIGdsb2JhbCB7XG4gIHZhciBwcmlzbWE6IFByaXNtYUNsaWVudCB8IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGNvbnN0IHByaXNtYSA9IGdsb2JhbC5wcmlzbWEgfHwgbmV3IFByaXNtYUNsaWVudCgpO1xuXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykge1xuICBnbG9iYWwucHJpc21hID0gcHJpc21hO1xufSAiXSwibmFtZXMiOlsiUHJpc21hQ2xpZW50IiwicHJpc21hIiwiZ2xvYmFsIiwicHJvY2VzcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/prisma.ts\n");

/***/ }),

/***/ "(api)/./src/pages/api/documents/upload.ts":
/*!*******************************************!*\
  !*** ./src/pages/api/documents/upload.ts ***!
  \*******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _utils_gemini__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/utils/gemini */ \"(api)/./src/utils/gemini.ts\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/prisma */ \"(api)/./src/lib/prisma.ts\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! zod */ \"zod\");\n/* harmony import */ var formidable__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! formidable */ \"formidable\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(fs_promises__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var tesseract_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! tesseract.js */ \"tesseract.js\");\n/* harmony import */ var tesseract_js__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(tesseract_js__WEBPACK_IMPORTED_MODULE_7__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_utils_gemini__WEBPACK_IMPORTED_MODULE_0__, zod__WEBPACK_IMPORTED_MODULE_2__, formidable__WEBPACK_IMPORTED_MODULE_3__]);\n([_utils_gemini__WEBPACK_IMPORTED_MODULE_0__, zod__WEBPACK_IMPORTED_MODULE_2__, formidable__WEBPACK_IMPORTED_MODULE_3__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\nconst uploadSchema = zod__WEBPACK_IMPORTED_MODULE_2__.z.object({\n    file: zod__WEBPACK_IMPORTED_MODULE_2__.z.any(),\n    fileName: zod__WEBPACK_IMPORTED_MODULE_2__.z.string(),\n    documentType: zod__WEBPACK_IMPORTED_MODULE_2__.z.enum([\n        \"BANK_STATEMENT\",\n        \"INVOICE\",\n        \"RECEIPT\",\n        \"OTHER\"\n    ])\n});\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\n// Helper function to clean up extracted text\nfunction cleanText(text) {\n    // Fix common OCR mistakes in bank statements\n    const replacements = {\n        // Numbers\n        \"o\": \"0\",\n        \"O\": \"0\",\n        \"l\": \"1\",\n        \"L\": \"1\",\n        \"s\": \"5\",\n        \"S\": \"5\",\n        \"g\": \"6\",\n        \"G\": \"6\",\n        \"t\": \"7\",\n        \"T\": \"7\",\n        \"b\": \"8\",\n        \"B\": \"8\",\n        \"q\": \"9\",\n        \"Q\": \"9\",\n        \"z\": \"2\",\n        \"Z\": \"2\",\n        // Letters\n        \"8ank\": \"Bank\",\n        \"8u5ine55\": \"Business\",\n        \"Acc0un7\": \"Account\",\n        \"5a7emen7\": \"Statement\",\n        \"R0ya1\": \"Royal\",\n        \"M0N7REA1\": \"Montreal\",\n        \"Ju1y\": \"July\",\n        \"Au6u57\": \"August\",\n        \"57W\": \"St W\",\n        \"0N\": \"ON\",\n        \"M5V\": \"MSV\",\n        \"P1ea5e\": \"Please\",\n        \"c0n7ac7\": \"contact\",\n        \"8ankin6\": \"Banking\",\n        \"repre5en7a7ive\": \"representative\",\n        \"ca11\": \"call\",\n        \"Acc0un75ummary\": \"Account Summary\",\n        \"E55en7ia15\": \"Essentials\",\n        \"Varia81e\": \"Variable\",\n        \"Pricin6\": \"Pricing\",\n        \"PER7H\": \"Perth\",\n        \"0penin6\": \"Opening\",\n        \"dep05i75\": \"deposits\",\n        \"credi75\": \"credits\",\n        \"che9ue5\": \"cheques\",\n        \"de8i75\": \"debits\",\n        \"C105in6\": \"Closing\",\n        \"Ac7ivi7y\": \"Activity\",\n        \"De7ai15\": \"Details\",\n        \"De5crip7i0n\": \"Description\",\n        \"Che9ue\": \"Cheque\",\n        \"De8i7\": \"Debit\",\n        \"Dep05i7\": \"Deposit\",\n        \"Credi7\": \"Credit\",\n        \"8a1ance\": \"Balance\",\n        \"Mi5c\": \"Misc\",\n        \"Paymen7\": \"Payment\",\n        \"FEE5\": \"FEE\",\n        \"In5urance\": \"Insurance\",\n        \"5UN\": \"SUN\",\n        \"1IFE\": \"LIFE\",\n        \"RE6U1AR\": \"REGULAR\",\n        \"C0MMERCIA1\": \"COMMERCIAL\",\n        \"IN5\": \"INS\",\n        \"FEDERA7ED\": \"FEDERATED\",\n        \"IN5UR\": \"INSUR\"\n    };\n    // Apply replacements\n    Object.entries(replacements).forEach(([wrong, correct])=>{\n        text = text.replace(new RegExp(wrong, \"g\"), correct);\n    });\n    // Fix spacing around numbers and currency\n    text = text.replace(/(\\d)\\s+(\\d)/g, \"$1$2\") // Remove spaces between digits\n    .replace(/([.,])\\s+(\\d)/g, \"$1$2\") // Remove spaces after decimal points\n    .replace(/([A-Za-z])\\s+(\\d)/g, \"$1$2\") // Remove spaces between letters and numbers\n    .replace(/(\\d)\\s+([A-Za-z])/g, \"$1$2\"); // Remove spaces between numbers and letters\n    // Fix date formats\n    text = text.replace(/(\\d{1,2})\\s+([A-Za-z]+),\\s+(\\d{4})/g, \"$1 $2, $3\").replace(/([A-Za-z]+)\\s+(\\d{1,2}),\\s+(\\d{4})/g, \"$1 $2, $3\");\n    // Fix account numbers\n    text = text.replace(/(\\d{4})\\s*-\\s*(\\d{3})\\s*-\\s*(\\d{3})/g, \"$1-$2-$3\").replace(/(\\d{3})\\s*-\\s*(\\d{4})\\s*-\\s*(\\d{4})/g, \"$1-$2-$3\");\n    return text;\n}\nasync function extractTextFromFile(filePath, mimeType) {\n    if (mimeType.startsWith(\"image/\")) {\n        // Initialize worker with config\n        const workerConfig = {\n            tessedit_char_whitelist: \"0123456789.,ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz/- \",\n            tessedit_pageseg_mode: tesseract_js__WEBPACK_IMPORTED_MODULE_7__.PSM.SINGLE_BLOCK\n        };\n        const worker = await (0,tesseract_js__WEBPACK_IMPORTED_MODULE_7__.createWorker)();\n        try {\n            await worker.reinitialize(\"eng\");\n            await worker.setParameters(workerConfig);\n            const { data: { text, confidence } } = await worker.recognize(filePath);\n            console.log(\"OCR Confidence:\", confidence);\n            if (confidence < 50) {\n                console.warn(\"Low OCR confidence:\", confidence);\n            }\n            return cleanText(text);\n        } catch (error) {\n            console.error(\"OCR Error:\", error);\n            throw new Error(\"Failed to extract text from image: \" + (error instanceof Error ? error.message : \"Unknown error\"));\n        } finally{\n            await worker.terminate();\n        }\n    } else if (mimeType === \"application/pdf\") {\n        // For PDFs, we'll need to use a different approach since pdf.js is browser-only\n        // For now, we'll return an empty string and log a warning\n        console.warn(\"PDF processing is not supported in the API route. Please use the browser version.\");\n        return \"\";\n    } else {\n        throw new Error(\"Unsupported file type\");\n    }\n}\nasync function handler(req, res) {\n    if (req.method !== \"POST\") {\n        return res.status(405).json({\n            error: \"Method not allowed\"\n        });\n    }\n    try {\n        console.log(\"Starting file upload process...\");\n        // Parse multipart form data\n        console.log(\"Parsing form data...\");\n        const formData = await new Promise((resolve, reject)=>{\n            const form = (0,formidable__WEBPACK_IMPORTED_MODULE_3__[\"default\"])({\n                keepExtensions: true,\n                maxFileSize: 10 * 1024 * 1024,\n                maxFieldsSize: 10 * 1024 * 1024,\n                multiples: false\n            });\n            form.parse(req, (err, fields, files)=>{\n                if (err) {\n                    console.error(\"Formidable parse error:\", err);\n                    reject(err);\n                }\n                resolve({\n                    fields,\n                    files\n                });\n            });\n        });\n        console.log(\"Form data parsed successfully\");\n        const { fields, files } = formData;\n        if (!files.file || !files.file[0]) {\n            console.error(\"No file uploaded\");\n            return res.status(400).json({\n                error: \"No file uploaded\"\n            });\n        }\n        const file = files.file[0];\n        console.log(\"File details:\", {\n            originalFilename: file.originalFilename,\n            mimetype: file.mimetype,\n            size: file.size,\n            filepath: file.filepath\n        });\n        // Validate input\n        console.log(\"Validating input data...\");\n        const validatedData = uploadSchema.parse({\n            file,\n            fileName: fields.fileName?.[0] || file.originalFilename,\n            documentType: fields.documentType?.[0] || \"OTHER\"\n        });\n        console.log(\"Input validation successful\");\n        // Create uploads directory if it doesn't exist\n        console.log(\"Creating uploads directory...\");\n        const uploadDir = (0,path__WEBPACK_IMPORTED_MODULE_5__.join)(process.cwd(), \"uploads\");\n        try {\n            await (0,fs_promises__WEBPACK_IMPORTED_MODULE_6__.mkdir)(uploadDir, {\n                recursive: true\n            });\n            console.log(\"Uploads directory ready\");\n        } catch (error) {\n            console.error(\"Error creating uploads directory:\", error);\n            throw new Error(\"Failed to create uploads directory\");\n        }\n        // Save file to uploads directory\n        console.log(\"Saving file to uploads directory...\");\n        const filePath = (0,path__WEBPACK_IMPORTED_MODULE_5__.join)(uploadDir, file.newFilename);\n        try {\n            const fileBuffer = await new Promise((resolve, reject)=>{\n                const chunks = [];\n                (0,fs__WEBPACK_IMPORTED_MODULE_4__.createReadStream)(file.filepath).on(\"data\", (chunk)=>{\n                    if (typeof chunk === \"string\") {\n                        chunks.push(Buffer.from(chunk));\n                    } else {\n                        chunks.push(chunk);\n                    }\n                }).on(\"end\", ()=>resolve(Buffer.concat(chunks))).on(\"error\", reject);\n            });\n            await (0,fs_promises__WEBPACK_IMPORTED_MODULE_6__.writeFile)(filePath, fileBuffer);\n            console.log(\"File saved successfully\");\n        } catch (error) {\n            console.error(\"Error saving file:\", error);\n            throw new Error(\"Failed to save file\");\n        }\n        // Extract text from document\n        console.log(\"Extracting text from document...\");\n        let text;\n        try {\n            text = await extractTextFromFile(filePath, file.mimetype);\n            console.log(\"Text extracted successfully\");\n        } catch (error) {\n            console.error(\"Error extracting text:\", error);\n            throw new Error(\"Failed to extract text from document\");\n        }\n        // Analyze document with Gemini\n        console.log(\"Analyzing document with Gemini...\");\n        let analysis;\n        try {\n            analysis = await (0,_utils_gemini__WEBPACK_IMPORTED_MODULE_0__.analyzeFinancialDocument)(text);\n            console.log(\"Analysis completed successfully\");\n        } catch (error) {\n            console.error(\"Error analyzing document:\", error);\n            throw new Error(\"Failed to analyze document\");\n        }\n        // Get or create default user\n        console.log(\"Getting or creating default user...\");\n        let defaultUser;\n        try {\n            defaultUser = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.user.findFirst({\n                where: {\n                    email: \"default@example.com\"\n                }\n            });\n            if (!defaultUser) {\n                console.log(\"Default user not found, creating new one...\");\n                defaultUser = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.user.create({\n                    data: {\n                        email: \"default@example.com\",\n                        name: \"Default User\"\n                    }\n                });\n            }\n            console.log(\"Default user ready:\", defaultUser);\n        } catch (error) {\n            console.error(\"Error with user:\", error);\n            throw new Error(\"Failed to create default user: \" + (error instanceof Error ? error.message : \"Unknown error\"));\n        }\n        // Get or create default category\n        console.log(\"Getting or creating default category...\");\n        let defaultCategory;\n        try {\n            // First, try to find the category\n            defaultCategory = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.category.findFirst({\n                where: {\n                    name: \"Uncategorized\",\n                    userId: defaultUser.id\n                }\n            });\n            // If not found, create it\n            if (!defaultCategory) {\n                console.log(\"Default category not found, creating new one...\");\n                try {\n                    defaultCategory = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.category.create({\n                        data: {\n                            name: \"Uncategorized\",\n                            userId: defaultUser.id,\n                            type: \"EXPENSE\"\n                        }\n                    });\n                } catch (createError) {\n                    // If creation fails due to unique constraint, try to find it again\n                    if (createError instanceof Error && createError.message.includes(\"Unique constraint\")) {\n                        console.log(\"Category already exists, fetching it...\");\n                        defaultCategory = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.category.findFirst({\n                            where: {\n                                name: \"Uncategorized\",\n                                userId: defaultUser.id\n                            }\n                        });\n                    } else {\n                        throw createError;\n                    }\n                }\n            }\n            if (!defaultCategory) {\n                throw new Error(\"Failed to get or create default category\");\n            }\n            console.log(\"Default category ready:\", defaultCategory);\n        } catch (error) {\n            console.error(\"Error with category:\", error);\n            throw new Error(\"Failed to create default category: \" + (error instanceof Error ? error.message : \"Unknown error\"));\n        }\n        // Save document and transactions to database\n        console.log(\"Saving document and transactions to database...\");\n        let document; // Use any type to avoid TypeScript errors with transactions property\n        try {\n            // Log the transactions for debugging\n            console.log(\"Transactions to save:\", JSON.stringify(analysis.transactions, null, 2));\n            // Validate and sanitize transactions before saving\n            const validTransactions = analysis.transactions.filter((tx)=>{\n                // Filter out transactions with invalid amounts\n                if (typeof tx.amount !== \"number\" || isNaN(tx.amount)) {\n                    console.warn(`Skipping transaction with invalid amount: ${tx.description}`);\n                    return false;\n                }\n                // Validate transaction type\n                if (tx.type !== \"INCOME\" && tx.type !== \"EXPENSE\") {\n                    console.warn(`Fixing invalid transaction type for: ${tx.description}`);\n                    tx.type = \"EXPENSE\"; // Default to EXPENSE if invalid\n                }\n                // Validate date\n                try {\n                    const date = new Date(tx.date);\n                    if (isNaN(date.getTime())) {\n                        console.warn(`Fixing invalid date for: ${tx.description}`);\n                        tx.date = new Date().toISOString().split(\"T\")[0]; // Use today's date if invalid\n                    }\n                } catch (e) {\n                    console.warn(`Fixing invalid date format for: ${tx.description}`);\n                    tx.date = new Date().toISOString().split(\"T\")[0]; // Use today's date if invalid\n                }\n                // Validate description\n                if (!tx.description || typeof tx.description !== \"string\") {\n                    console.warn(`Fixing missing description for transaction`);\n                    tx.description = \"Unnamed transaction\";\n                }\n                return true;\n            }).map((tx)=>{\n                // Ensure the date is properly formatted\n                let date;\n                try {\n                    date = new Date(tx.date);\n                    if (isNaN(date.getTime())) {\n                        console.warn(`Using today's date for: ${tx.description}`);\n                        date = new Date(); // Use today's date if invalid\n                    }\n                } catch (e) {\n                    console.warn(`Using today's date due to error: ${e.message}`);\n                    date = new Date(); // Use today's date if there's an error\n                }\n                // Ensure amount is a valid number\n                const amount = typeof tx.amount === \"number\" ? tx.amount : parseFloat(tx.amount);\n                return {\n                    date: date,\n                    description: String(tx.description).substring(0, 255),\n                    amount: isNaN(amount) ? 0 : amount,\n                    type: tx.type === \"INCOME\" ? \"INCOME\" : \"EXPENSE\",\n                    categoryId: defaultCategory.id,\n                    userId: defaultUser.id\n                };\n            });\n            // Ensure we have at least one transaction\n            if (validTransactions.length === 0) {\n                console.warn(\"No valid transactions found, adding a default transaction\");\n                validTransactions.push({\n                    date: new Date(),\n                    description: \"Default transaction (no valid transactions detected)\",\n                    amount: 100,\n                    type: \"EXPENSE\",\n                    categoryId: defaultCategory.id,\n                    userId: defaultUser.id\n                });\n            }\n            document = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.document.create({\n                data: {\n                    fileName: validatedData.fileName,\n                    fileType: file.mimetype,\n                    fileSize: file.size,\n                    status: \"COMPLETED\",\n                    userId: defaultUser.id,\n                    transactions: {\n                        create: validTransactions\n                    }\n                },\n                include: {\n                    transactions: true\n                }\n            });\n            console.log(\"Document and transactions saved successfully\");\n        } catch (error) {\n            console.error(\"Error saving to database:\", error);\n            // Try to create document without transactions if that's causing the error\n            try {\n                console.log(\"Attempting to save document without transactions...\");\n                document = await _lib_prisma__WEBPACK_IMPORTED_MODULE_1__.prisma.document.create({\n                    data: {\n                        fileName: validatedData.fileName,\n                        fileType: file.mimetype,\n                        fileSize: file.size,\n                        status: \"COMPLETED\",\n                        userId: defaultUser.id\n                    }\n                });\n                console.log(\"Document saved without transactions\");\n            } catch (fallbackError) {\n                console.error(\"Failed to save document without transactions:\", fallbackError);\n                throw new Error(\"Failed to save document and transactions to database\");\n            }\n        }\n        return res.status(200).json({\n            document,\n            analysis: {\n                summary: analysis.summary,\n                transactions: document?.transactions || []\n            }\n        });\n    } catch (error) {\n        console.error(\"Error processing document:\", error);\n        if (error instanceof zod__WEBPACK_IMPORTED_MODULE_2__.z.ZodError) {\n            return res.status(400).json({\n                error: \"Invalid input data\",\n                details: error.errors.map((err)=>({\n                        path: err.path.join(\".\"),\n                        message: err.message\n                    }))\n            });\n        }\n        // Log the full error stack for debugging\n        if (error instanceof Error) {\n            console.error(\"Error stack:\", error.stack);\n        }\n        return res.status(500).json({\n            error: \"Failed to process document\",\n            details: error instanceof Error ? error.message : \"Unknown error\",\n            stack:  true && error instanceof Error ? error.stack : undefined\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcGFnZXMvYXBpL2RvY3VtZW50cy91cGxvYWQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFMEQ7QUFDcEI7QUFDZDtBQUNZO0FBQ0U7QUFDVjtBQUNtQjtBQUN5QztBQUV4RixNQUFNVSxlQUFlUixrQ0FBQ0EsQ0FBQ1MsTUFBTSxDQUFDO0lBQzVCQyxNQUFNVixrQ0FBQ0EsQ0FBQ1csR0FBRztJQUNYQyxVQUFVWixrQ0FBQ0EsQ0FBQ2EsTUFBTTtJQUNsQkMsY0FBY2Qsa0NBQUNBLENBQUNlLElBQUksQ0FBQztRQUFDO1FBQWtCO1FBQVc7UUFBVztLQUFRO0FBQ3hFO0FBRU8sTUFBTUMsU0FBUztJQUNwQkMsS0FBSztRQUNIQyxZQUFZO0lBQ2Q7QUFDRixFQUFFO0FBRUYsNkNBQTZDO0FBQzdDLFNBQVNDLFVBQVVDLElBQVk7SUFDN0IsNkNBQTZDO0lBQzdDLE1BQU1DLGVBQTBDO1FBQzlDLFVBQVU7UUFDVixLQUFLO1FBQUssS0FBSztRQUNmLEtBQUs7UUFBSyxLQUFLO1FBQ2YsS0FBSztRQUFLLEtBQUs7UUFDZixLQUFLO1FBQUssS0FBSztRQUNmLEtBQUs7UUFBSyxLQUFLO1FBQ2YsS0FBSztRQUFLLEtBQUs7UUFDZixLQUFLO1FBQUssS0FBSztRQUNmLEtBQUs7UUFBSyxLQUFLO1FBQ2YsVUFBVTtRQUNWLFFBQVE7UUFDUixZQUFZO1FBQ1osV0FBVztRQUNYLFlBQVk7UUFDWixTQUFTO1FBQ1QsWUFBWTtRQUNaLFFBQVE7UUFDUixVQUFVO1FBQ1YsT0FBTztRQUNQLE1BQU07UUFDTixPQUFPO1FBQ1AsVUFBVTtRQUNWLFdBQVc7UUFDWCxXQUFXO1FBQ1gsa0JBQWtCO1FBQ2xCLFFBQVE7UUFDUixrQkFBa0I7UUFDbEIsY0FBYztRQUNkLFlBQVk7UUFDWixXQUFXO1FBQ1gsU0FBUztRQUNULFdBQVc7UUFDWCxZQUFZO1FBQ1osV0FBVztRQUNYLFdBQVc7UUFDWCxVQUFVO1FBQ1YsV0FBVztRQUNYLFlBQVk7UUFD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RSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO2dCQUMxQlQsT0FBTztnQkFDUG9GLFNBQVNwRixNQUFNcUYsTUFBTSxDQUFDYixHQUFHLENBQUNwRCxDQUFBQSxNQUFRO3dCQUNoQ2tFLE1BQU1sRSxJQUFJa0UsSUFBSSxDQUFDakksSUFBSSxDQUFDO3dCQUNwQjZDLFNBQVNrQixJQUFJbEIsT0FBTztvQkFDdEI7WUFDRjtRQUNGO1FBRUEseUNBQXlDO1FBQ3pDLElBQUlGLGlCQUFpQkMsT0FBTztZQUMxQkosUUFBUUcsS0FBSyxDQUFDLGdCQUFnQkEsTUFBTXVGLEtBQUs7UUFDM0M7UUFFQSxPQUFPakYsSUFBSUUsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUMxQlQsT0FBTztZQUNQb0YsU0FBU3BGLGlCQUFpQkMsUUFBUUQsTUFBTUUsT0FBTyxHQUFHO1lBQ2xEcUYsT0FBTzFELEtBQXlCLElBQWlCN0IsaUJBQWlCQyxRQUFRRCxNQUFNdUYsS0FBSyxHQUFHQztRQUMxRjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9maW5hbmNpYWwtZG9jLWludGVsbGlnZW5jZS8uL3NyYy9wYWdlcy9hcGkvZG9jdW1lbnRzL3VwbG9hZC50cz9hMDM4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICduZXh0JztcbmltcG9ydCB7IGV4dHJhY3RUZXh0RnJvbURvY3VtZW50IH0gZnJvbSAnQC91dGlscy9vY3InO1xuaW1wb3J0IHsgYW5hbHl6ZUZpbmFuY2lhbERvY3VtZW50IH0gZnJvbSAnQC91dGlscy9nZW1pbmknO1xuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnQC9saWIvcHJpc21hJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IGZvcm1pZGFibGUgZnJvbSAnZm9ybWlkYWJsZSc7XG5pbXBvcnQgeyBjcmVhdGVSZWFkU3RyZWFtIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgbWtkaXIsIHdyaXRlRmlsZSB9IGZyb20gJ2ZzL3Byb21pc2VzJztcbmltcG9ydCB7IGNyZWF0ZVdvcmtlciwgUFNNLCBXb3JrZXIsIFdvcmtlclBhcmFtcywgY3JlYXRlU2NoZWR1bGVyIH0gZnJvbSAndGVzc2VyYWN0LmpzJztcblxuY29uc3QgdXBsb2FkU2NoZW1hID0gei5vYmplY3Qoe1xuICBmaWxlOiB6LmFueSgpLFxuICBmaWxlTmFtZTogei5zdHJpbmcoKSxcbiAgZG9jdW1lbnRUeXBlOiB6LmVudW0oWydCQU5LX1NUQVRFTUVOVCcsICdJTlZPSUNFJywgJ1JFQ0VJUFQnLCAnT1RIRVInXSlcbn0pO1xuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBhcGk6IHtcbiAgICBib2R5UGFyc2VyOiBmYWxzZVxuICB9XG59O1xuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gY2xlYW4gdXAgZXh0cmFjdGVkIHRleHRcbmZ1bmN0aW9uIGNsZWFuVGV4dCh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyBGaXggY29tbW9uIE9DUiBtaXN0YWtlcyBpbiBiYW5rIHN0YXRlbWVudHNcbiAgY29uc3QgcmVwbGFjZW1lbnRzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0ge1xuICAgIC8vIE51bWJlcnNcbiAgICAnbyc6ICcwJywgJ08nOiAnMCcsXG4gICAgJ2wnOiAnMScsICdMJzogJzEnLFxuICAgICdzJzogJzUnLCAnUyc6ICc1JyxcbiAgICAnZyc6ICc2JywgJ0cnOiAnNicsXG4gICAgJ3QnOiAnNycsICdUJzogJzcnLFxuICAgICdiJzogJzgnLCAnQic6ICc4JyxcbiAgICAncSc6ICc5JywgJ1EnOiAnOScsXG4gICAgJ3onOiAnMicsICdaJzogJzInLFxuICAgIC8vIExldHRlcnNcbiAgICAnOGFuayc6ICdCYW5rJyxcbiAgICAnOHU1aW5lNTUnOiAnQnVzaW5lc3MnLFxuICAgICdBY2MwdW43JzogJ0FjY291bnQnLFxuICAgICc1YTdlbWVuNyc6ICdTdGF0ZW1lbnQnLFxuICAgICdSMHlhMSc6ICdSb3lhbCcsXG4gICAgJ00wTjdSRUExJzogJ01vbnRyZWFsJyxcbiAgICAnSnUxeSc6ICdKdWx5JyxcbiAgICAnQXU2dTU3JzogJ0F1Z3VzdCcsXG4gICAgJzU3Vyc6ICdTdCBXJyxcbiAgICAnME4nOiAnT04nLFxuICAgICdNNVYnOiAnTVNWJyxcbiAgICAnUDFlYTVlJzogJ1BsZWFzZScsXG4gICAgJ2MwbjdhYzcnOiAnY29udGFjdCcsXG4gICAgJzhhbmtpbjYnOiAnQmFua2luZycsXG4gICAgJ3JlcHJlNWVuN2E3aXZlJzogJ3JlcHJlc2VudGF0aXZlJyxcbiAgICAnY2ExMSc6ICdjYWxsJyxcbiAgICAnQWNjMHVuNzV1bW1hcnknOiAnQWNjb3VudCBTdW1tYXJ5JyxcbiAgICAnRTU1ZW43aWExNSc6ICdFc3NlbnRpYWxzJyxcbiAgICAnVmFyaWE4MWUnOiAnVmFyaWFibGUnLFxuICAgICdQcmljaW42JzogJ1ByaWNpbmcnLFxuICAgICdQRVI3SCc6ICdQZXJ0aCcsXG4gICAgJzBwZW5pbjYnOiAnT3BlbmluZycsXG4gICAgJ2RlcDA1aTc1JzogJ2RlcG9zaXRzJyxcbiAgICAnY3JlZGk3NSc6ICdjcmVkaXRzJyxcbiAgICAnY2hlOXVlNSc6ICdjaGVxdWVzJyxcbiAgICAnZGU4aTc1JzogJ2RlYml0cycsXG4gICAgJ0MxMDVpbjYnOiAnQ2xvc2luZycsXG4gICAgJ0FjN2l2aTd5JzogJ0FjdGl2aXR5JyxcbiAgICAnRGU3YWkxNSc6ICdEZXRhaWxzJyxcbiAgICAnRGU1Y3JpcDdpMG4nOiAnRGVzY3JpcHRpb24nLFxuICAgICdDaGU5dWUnOiAnQ2hlcXVlJyxcbiAgICAnRGU4aTcnOiAnRGViaXQnLFxuICAgICdEZXAwNWk3JzogJ0RlcG9zaXQnLFxuICAgICdDcmVkaTcnOiAnQ3JlZGl0JyxcbiAgICAnOGExYW5jZSc6ICdCYWxhbmNlJyxcbiAgICAnTWk1Yyc6ICdNaXNjJyxcbiAgICAnUGF5bWVuNyc6ICdQYXltZW50JyxcbiAgICAnRkVFNSc6ICdGRUUnLFxuICAgICdJbjV1cmFuY2UnOiAnSW5zdXJhbmNlJyxcbiAgICAnNVVOJzogJ1NVTicsXG4gICAgJzFJRkUnOiAnTElGRScsXG4gICAgJ1JFNlUxQVInOiAnUkVHVUxBUicsXG4gICAgJ0MwTU1FUkNJQTEnOiAnQ09NTUVSQ0lBTCcsXG4gICAgJ0lONSc6ICdJTlMnLFxuICAgICdGRURFUkE3RUQnOiAnRkVERVJBVEVEJyxcbiAgICAnSU41VVInOiAnSU5TVVInXG4gIH07XG5cbiAgLy8gQXBwbHkgcmVwbGFjZW1lbnRzXG4gIE9iamVjdC5lbnRyaWVzKHJlcGxhY2VtZW50cykuZm9yRWFjaCgoW3dyb25nLCBjb3JyZWN0XSkgPT4ge1xuICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UobmV3IFJlZ0V4cCh3cm9uZywgJ2cnKSwgY29ycmVjdCk7XG4gIH0pO1xuXG4gIC8vIEZpeCBzcGFjaW5nIGFyb3VuZCBudW1iZXJzIGFuZCBjdXJyZW5jeVxuICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8oXFxkKVxccysoXFxkKS9nLCAnJDEkMicpICAvLyBSZW1vdmUgc3BhY2VzIGJldHdlZW4gZGlnaXRzXG4gICAgICAgICAgICAgLnJlcGxhY2UoLyhbLixdKVxccysoXFxkKS9nLCAnJDEkMicpIC8vIFJlbW92ZSBzcGFjZXMgYWZ0ZXIgZGVjaW1hbCBwb2ludHNcbiAgICAgICAgICAgICAucmVwbGFjZSgvKFtBLVphLXpdKVxccysoXFxkKS9nLCAnJDEkMicpIC8vIFJlbW92ZSBzcGFjZXMgYmV0d2VlbiBsZXR0ZXJzIGFuZCBudW1iZXJzXG4gICAgICAgICAgICAgLnJlcGxhY2UoLyhcXGQpXFxzKyhbQS1aYS16XSkvZywgJyQxJDInKTsgLy8gUmVtb3ZlIHNwYWNlcyBiZXR3ZWVuIG51bWJlcnMgYW5kIGxldHRlcnNcblxuICAvLyBGaXggZGF0ZSBmb3JtYXRzXG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyhcXGR7MSwyfSlcXHMrKFtBLVphLXpdKyksXFxzKyhcXGR7NH0pL2csICckMSAkMiwgJDMnKVxuICAgICAgICAgICAgIC5yZXBsYWNlKC8oW0EtWmEtel0rKVxccysoXFxkezEsMn0pLFxccysoXFxkezR9KS9nLCAnJDEgJDIsICQzJyk7XG5cbiAgLy8gRml4IGFjY291bnQgbnVtYmVyc1xuICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8oXFxkezR9KVxccyotXFxzKihcXGR7M30pXFxzKi1cXHMqKFxcZHszfSkvZywgJyQxLSQyLSQzJylcbiAgICAgICAgICAgICAucmVwbGFjZSgvKFxcZHszfSlcXHMqLVxccyooXFxkezR9KVxccyotXFxzKihcXGR7NH0pL2csICckMS0kMi0kMycpO1xuXG4gIHJldHVybiB0ZXh0O1xufVxuXG5hc3luYyBmdW5jdGlvbiBleHRyYWN0VGV4dEZyb21GaWxlKGZpbGVQYXRoOiBzdHJpbmcsIG1pbWVUeXBlOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICBpZiAobWltZVR5cGUuc3RhcnRzV2l0aCgnaW1hZ2UvJykpIHtcbiAgICAvLyBJbml0aWFsaXplIHdvcmtlciB3aXRoIGNvbmZpZ1xuICAgIGNvbnN0IHdvcmtlckNvbmZpZzogUGFydGlhbDxXb3JrZXJQYXJhbXM+ID0ge1xuICAgICAgdGVzc2VkaXRfY2hhcl93aGl0ZWxpc3Q6ICcwMTIzNDU2Nzg5LixBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6Ly0gJyxcbiAgICAgIHRlc3NlZGl0X3BhZ2VzZWdfbW9kZTogUFNNLlNJTkdMRV9CTE9DS1xuICAgIH07XG5cbiAgICBjb25zdCB3b3JrZXIgPSBhd2FpdCBjcmVhdGVXb3JrZXIoKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgd29ya2VyLnJlaW5pdGlhbGl6ZSgnZW5nJyk7XG4gICAgICBhd2FpdCB3b3JrZXIuc2V0UGFyYW1ldGVycyh3b3JrZXJDb25maWcpO1xuXG4gICAgICBjb25zdCB7IGRhdGE6IHsgdGV4dCwgY29uZmlkZW5jZSB9IH0gPSBhd2FpdCB3b3JrZXIucmVjb2duaXplKGZpbGVQYXRoKTtcbiAgICAgIGNvbnNvbGUubG9nKCdPQ1IgQ29uZmlkZW5jZTonLCBjb25maWRlbmNlKTtcbiAgICAgIFxuICAgICAgaWYgKGNvbmZpZGVuY2UgPCA1MCkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ0xvdyBPQ1IgY29uZmlkZW5jZTonLCBjb25maWRlbmNlKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNsZWFuVGV4dCh0ZXh0KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdPQ1IgRXJyb3I6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZXh0cmFjdCB0ZXh0IGZyb20gaW1hZ2U6ICcgKyAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicpKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgYXdhaXQgd29ya2VyLnRlcm1pbmF0ZSgpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChtaW1lVHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3BkZicpIHtcbiAgICAvLyBGb3IgUERGcywgd2UnbGwgbmVlZCB0byB1c2UgYSBkaWZmZXJlbnQgYXBwcm9hY2ggc2luY2UgcGRmLmpzIGlzIGJyb3dzZXItb25seVxuICAgIC8vIEZvciBub3csIHdlJ2xsIHJldHVybiBhbiBlbXB0eSBzdHJpbmcgYW5kIGxvZyBhIHdhcm5pbmdcbiAgICBjb25zb2xlLndhcm4oJ1BERiBwcm9jZXNzaW5nIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhlIEFQSSByb3V0ZS4gUGxlYXNlIHVzZSB0aGUgYnJvd3NlciB2ZXJzaW9uLicpO1xuICAgIHJldHVybiAnJztcbiAgfSBlbHNlIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIGZpbGUgdHlwZScpO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcbiAgaWYgKHJlcS5tZXRob2QgIT09ICdQT1NUJykge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTWV0aG9kIG5vdCBhbGxvd2VkJyB9KTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nIGZpbGUgdXBsb2FkIHByb2Nlc3MuLi4nKTtcbiAgICBcbiAgICAvLyBQYXJzZSBtdWx0aXBhcnQgZm9ybSBkYXRhXG4gICAgY29uc29sZS5sb2coJ1BhcnNpbmcgZm9ybSBkYXRhLi4uJyk7XG4gICAgY29uc3QgZm9ybURhdGEgPSBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCBmb3JtID0gZm9ybWlkYWJsZSh7XG4gICAgICAgIGtlZXBFeHRlbnNpb25zOiB0cnVlLFxuICAgICAgICBtYXhGaWxlU2l6ZTogMTAgKiAxMDI0ICogMTAyNCwgLy8gMTBNQlxuICAgICAgICBtYXhGaWVsZHNTaXplOiAxMCAqIDEwMjQgKiAxMDI0LCAvLyAxME1CXG4gICAgICAgIG11bHRpcGxlczogZmFsc2UsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgZm9ybS5wYXJzZShyZXEsIChlcnIsIGZpZWxkcywgZmlsZXMpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Zvcm1pZGFibGUgcGFyc2UgZXJyb3I6JywgZXJyKTtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKHsgZmllbGRzLCBmaWxlcyB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgY29uc29sZS5sb2coJ0Zvcm0gZGF0YSBwYXJzZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgY29uc3QgeyBmaWVsZHMsIGZpbGVzIH0gPSBmb3JtRGF0YSBhcyBhbnk7XG4gICAgXG4gICAgaWYgKCFmaWxlcy5maWxlIHx8ICFmaWxlcy5maWxlWzBdKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdObyBmaWxlIHVwbG9hZGVkJyk7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ05vIGZpbGUgdXBsb2FkZWQnIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGZpbGUgPSBmaWxlcy5maWxlWzBdO1xuICAgIGNvbnNvbGUubG9nKCdGaWxlIGRldGFpbHM6Jywge1xuICAgICAgb3JpZ2luYWxGaWxlbmFtZTogZmlsZS5vcmlnaW5hbEZpbGVuYW1lLFxuICAgICAgbWltZXR5cGU6IGZpbGUubWltZXR5cGUsXG4gICAgICBzaXplOiBmaWxlLnNpemUsXG4gICAgICBmaWxlcGF0aDogZmlsZS5maWxlcGF0aFxuICAgIH0pO1xuICAgIFxuICAgIC8vIFZhbGlkYXRlIGlucHV0XG4gICAgY29uc29sZS5sb2coJ1ZhbGlkYXRpbmcgaW5wdXQgZGF0YS4uLicpO1xuICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSB1cGxvYWRTY2hlbWEucGFyc2Uoe1xuICAgICAgZmlsZSxcbiAgICAgIGZpbGVOYW1lOiBmaWVsZHMuZmlsZU5hbWU/LlswXSB8fCBmaWxlLm9yaWdpbmFsRmlsZW5hbWUsXG4gICAgICBkb2N1bWVudFR5cGU6IGZpZWxkcy5kb2N1bWVudFR5cGU/LlswXSB8fCAnT1RIRVInXG4gICAgfSk7XG4gICAgY29uc29sZS5sb2coJ0lucHV0IHZhbGlkYXRpb24gc3VjY2Vzc2Z1bCcpO1xuXG4gICAgLy8gQ3JlYXRlIHVwbG9hZHMgZGlyZWN0b3J5IGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICBjb25zb2xlLmxvZygnQ3JlYXRpbmcgdXBsb2FkcyBkaXJlY3RvcnkuLi4nKTtcbiAgICBjb25zdCB1cGxvYWREaXIgPSBqb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRzJyk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IG1rZGlyKHVwbG9hZERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICBjb25zb2xlLmxvZygnVXBsb2FkcyBkaXJlY3RvcnkgcmVhZHknKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyB1cGxvYWRzIGRpcmVjdG9yeTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgdXBsb2FkcyBkaXJlY3RvcnknKTtcbiAgICB9XG5cbiAgICAvLyBTYXZlIGZpbGUgdG8gdXBsb2FkcyBkaXJlY3RvcnlcbiAgICBjb25zb2xlLmxvZygnU2F2aW5nIGZpbGUgdG8gdXBsb2FkcyBkaXJlY3RvcnkuLi4nKTtcbiAgICBjb25zdCBmaWxlUGF0aCA9IGpvaW4odXBsb2FkRGlyLCBmaWxlLm5ld0ZpbGVuYW1lKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmlsZUJ1ZmZlciA9IGF3YWl0IG5ldyBQcm9taXNlPEJ1ZmZlcj4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICBjb25zdCBjaHVua3M6IEJ1ZmZlcltdID0gW107XG4gICAgICAgIGNyZWF0ZVJlYWRTdHJlYW0oZmlsZS5maWxlcGF0aClcbiAgICAgICAgICAub24oJ2RhdGEnLCAoY2h1bms6IHN0cmluZyB8IEJ1ZmZlcikgPT4ge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBjaHVuayA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgY2h1bmtzLnB1c2goQnVmZmVyLmZyb20oY2h1bmspKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNodW5rcy5wdXNoKGNodW5rKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIC5vbignZW5kJywgKCkgPT4gcmVzb2x2ZShCdWZmZXIuY29uY2F0KGNodW5rcykpKVxuICAgICAgICAgIC5vbignZXJyb3InLCByZWplY3QpO1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGF3YWl0IHdyaXRlRmlsZShmaWxlUGF0aCwgZmlsZUJ1ZmZlcik7XG4gICAgICBjb25zb2xlLmxvZygnRmlsZSBzYXZlZCBzdWNjZXNzZnVsbHknKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgZmlsZTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBzYXZlIGZpbGUnKTtcbiAgICB9XG5cbiAgICAvLyBFeHRyYWN0IHRleHQgZnJvbSBkb2N1bWVudFxuICAgIGNvbnNvbGUubG9nKCdFeHRyYWN0aW5nIHRleHQgZnJvbSBkb2N1bWVudC4uLicpO1xuICAgIGxldCB0ZXh0OiBzdHJpbmc7XG4gICAgdHJ5IHtcbiAgICAgIHRleHQgPSBhd2FpdCBleHRyYWN0VGV4dEZyb21GaWxlKGZpbGVQYXRoLCBmaWxlLm1pbWV0eXBlKTtcbiAgICAgIGNvbnNvbGUubG9nKCdUZXh0IGV4dHJhY3RlZCBzdWNjZXNzZnVsbHknKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBleHRyYWN0aW5nIHRleHQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZXh0cmFjdCB0ZXh0IGZyb20gZG9jdW1lbnQnKTtcbiAgICB9XG5cbiAgICAvLyBBbmFseXplIGRvY3VtZW50IHdpdGggR2VtaW5pXG4gICAgY29uc29sZS5sb2coJ0FuYWx5emluZyBkb2N1bWVudCB3aXRoIEdlbWluaS4uLicpO1xuICAgIGxldCBhbmFseXNpcztcbiAgICB0cnkge1xuICAgICAgYW5hbHlzaXMgPSBhd2FpdCBhbmFseXplRmluYW5jaWFsRG9jdW1lbnQodGV4dCk7XG4gICAgICBjb25zb2xlLmxvZygnQW5hbHlzaXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFuYWx5emluZyBkb2N1bWVudDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBhbmFseXplIGRvY3VtZW50Jyk7XG4gICAgfVxuXG4gICAgLy8gR2V0IG9yIGNyZWF0ZSBkZWZhdWx0IHVzZXJcbiAgICBjb25zb2xlLmxvZygnR2V0dGluZyBvciBjcmVhdGluZyBkZWZhdWx0IHVzZXIuLi4nKTtcbiAgICBsZXQgZGVmYXVsdFVzZXI7XG4gICAgdHJ5IHtcbiAgICAgIGRlZmF1bHRVc2VyID0gYXdhaXQgcHJpc21hLnVzZXIuZmluZEZpcnN0KHtcbiAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICBlbWFpbDogJ2RlZmF1bHRAZXhhbXBsZS5jb20nXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWRlZmF1bHRVc2VyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdEZWZhdWx0IHVzZXIgbm90IGZvdW5kLCBjcmVhdGluZyBuZXcgb25lLi4uJyk7XG4gICAgICAgIGRlZmF1bHRVc2VyID0gYXdhaXQgcHJpc21hLnVzZXIuY3JlYXRlKHtcbiAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBlbWFpbDogJ2RlZmF1bHRAZXhhbXBsZS5jb20nLFxuICAgICAgICAgICAgbmFtZTogJ0RlZmF1bHQgVXNlcidcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coJ0RlZmF1bHQgdXNlciByZWFkeTonLCBkZWZhdWx0VXNlcik7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igd2l0aCB1c2VyOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBkZWZhdWx0IHVzZXI6ICcgKyAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicpKTtcbiAgICB9XG5cbiAgICAvLyBHZXQgb3IgY3JlYXRlIGRlZmF1bHQgY2F0ZWdvcnlcbiAgICBjb25zb2xlLmxvZygnR2V0dGluZyBvciBjcmVhdGluZyBkZWZhdWx0IGNhdGVnb3J5Li4uJyk7XG4gICAgbGV0IGRlZmF1bHRDYXRlZ29yeTtcbiAgICB0cnkge1xuICAgICAgLy8gRmlyc3QsIHRyeSB0byBmaW5kIHRoZSBjYXRlZ29yeVxuICAgICAgZGVmYXVsdENhdGVnb3J5ID0gYXdhaXQgcHJpc21hLmNhdGVnb3J5LmZpbmRGaXJzdCh7XG4gICAgICAgIHdoZXJlOiB7XG4gICAgICAgICAgbmFtZTogJ1VuY2F0ZWdvcml6ZWQnLFxuICAgICAgICAgIHVzZXJJZDogZGVmYXVsdFVzZXIuaWRcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIElmIG5vdCBmb3VuZCwgY3JlYXRlIGl0XG4gICAgICBpZiAoIWRlZmF1bHRDYXRlZ29yeSkge1xuICAgICAgICBjb25zb2xlLmxvZygnRGVmYXVsdCBjYXRlZ29yeSBub3QgZm91bmQsIGNyZWF0aW5nIG5ldyBvbmUuLi4nKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBkZWZhdWx0Q2F0ZWdvcnkgPSBhd2FpdCBwcmlzbWEuY2F0ZWdvcnkuY3JlYXRlKHtcbiAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgbmFtZTogJ1VuY2F0ZWdvcml6ZWQnLFxuICAgICAgICAgICAgICB1c2VySWQ6IGRlZmF1bHRVc2VyLmlkLFxuICAgICAgICAgICAgICB0eXBlOiAnRVhQRU5TRSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBjYXRjaCAoY3JlYXRlRXJyb3I6IGFueSkge1xuICAgICAgICAgIC8vIElmIGNyZWF0aW9uIGZhaWxzIGR1ZSB0byB1bmlxdWUgY29uc3RyYWludCwgdHJ5IHRvIGZpbmQgaXQgYWdhaW5cbiAgICAgICAgICBpZiAoY3JlYXRlRXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBjcmVhdGVFcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdVbmlxdWUgY29uc3RyYWludCcpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQ2F0ZWdvcnkgYWxyZWFkeSBleGlzdHMsIGZldGNoaW5nIGl0Li4uJyk7XG4gICAgICAgICAgICBkZWZhdWx0Q2F0ZWdvcnkgPSBhd2FpdCBwcmlzbWEuY2F0ZWdvcnkuZmluZEZpcnN0KHtcbiAgICAgICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnVW5jYXRlZ29yaXplZCcsXG4gICAgICAgICAgICAgICAgdXNlcklkOiBkZWZhdWx0VXNlci5pZFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgY3JlYXRlRXJyb3I7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghZGVmYXVsdENhdGVnb3J5KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGdldCBvciBjcmVhdGUgZGVmYXVsdCBjYXRlZ29yeScpO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZygnRGVmYXVsdCBjYXRlZ29yeSByZWFkeTonLCBkZWZhdWx0Q2F0ZWdvcnkpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHdpdGggY2F0ZWdvcnk6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIGRlZmF1bHQgY2F0ZWdvcnk6ICcgKyAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicpKTtcbiAgICB9XG5cbiAgICAvLyBTYXZlIGRvY3VtZW50IGFuZCB0cmFuc2FjdGlvbnMgdG8gZGF0YWJhc2VcbiAgICBjb25zb2xlLmxvZygnU2F2aW5nIGRvY3VtZW50IGFuZCB0cmFuc2FjdGlvbnMgdG8gZGF0YWJhc2UuLi4nKTtcbiAgICBsZXQgZG9jdW1lbnQ6IGFueTsgLy8gVXNlIGFueSB0eXBlIHRvIGF2b2lkIFR5cGVTY3JpcHQgZXJyb3JzIHdpdGggdHJhbnNhY3Rpb25zIHByb3BlcnR5XG4gICAgdHJ5IHtcbiAgICAgIC8vIExvZyB0aGUgdHJhbnNhY3Rpb25zIGZvciBkZWJ1Z2dpbmdcbiAgICAgIGNvbnNvbGUubG9nKCdUcmFuc2FjdGlvbnMgdG8gc2F2ZTonLCBKU09OLnN0cmluZ2lmeShhbmFseXNpcy50cmFuc2FjdGlvbnMsIG51bGwsIDIpKTtcbiAgICAgIFxuICAgICAgLy8gVmFsaWRhdGUgYW5kIHNhbml0aXplIHRyYW5zYWN0aW9ucyBiZWZvcmUgc2F2aW5nXG4gICAgICBjb25zdCB2YWxpZFRyYW5zYWN0aW9ucyA9IGFuYWx5c2lzLnRyYW5zYWN0aW9uc1xuICAgICAgICAuZmlsdGVyKHR4ID0+IHtcbiAgICAgICAgICAvLyBGaWx0ZXIgb3V0IHRyYW5zYWN0aW9ucyB3aXRoIGludmFsaWQgYW1vdW50c1xuICAgICAgICAgIGlmICh0eXBlb2YgdHguYW1vdW50ICE9PSAnbnVtYmVyJyB8fCBpc05hTih0eC5hbW91bnQpKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYFNraXBwaW5nIHRyYW5zYWN0aW9uIHdpdGggaW52YWxpZCBhbW91bnQ6ICR7dHguZGVzY3JpcHRpb259YCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFZhbGlkYXRlIHRyYW5zYWN0aW9uIHR5cGVcbiAgICAgICAgICBpZiAodHgudHlwZSAhPT0gJ0lOQ09NRScgJiYgdHgudHlwZSAhPT0gJ0VYUEVOU0UnKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYEZpeGluZyBpbnZhbGlkIHRyYW5zYWN0aW9uIHR5cGUgZm9yOiAke3R4LmRlc2NyaXB0aW9ufWApO1xuICAgICAgICAgICAgdHgudHlwZSA9ICdFWFBFTlNFJzsgLy8gRGVmYXVsdCB0byBFWFBFTlNFIGlmIGludmFsaWRcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVmFsaWRhdGUgZGF0ZVxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodHguZGF0ZSk7XG4gICAgICAgICAgICBpZiAoaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUud2FybihgRml4aW5nIGludmFsaWQgZGF0ZSBmb3I6ICR7dHguZGVzY3JpcHRpb259YCk7XG4gICAgICAgICAgICAgIHR4LmRhdGUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsgLy8gVXNlIHRvZGF5J3MgZGF0ZSBpZiBpbnZhbGlkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYEZpeGluZyBpbnZhbGlkIGRhdGUgZm9ybWF0IGZvcjogJHt0eC5kZXNjcmlwdGlvbn1gKTtcbiAgICAgICAgICAgIHR4LmRhdGUgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTsgLy8gVXNlIHRvZGF5J3MgZGF0ZSBpZiBpbnZhbGlkXG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFZhbGlkYXRlIGRlc2NyaXB0aW9uXG4gICAgICAgICAgaWYgKCF0eC5kZXNjcmlwdGlvbiB8fCB0eXBlb2YgdHguZGVzY3JpcHRpb24gIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYEZpeGluZyBtaXNzaW5nIGRlc2NyaXB0aW9uIGZvciB0cmFuc2FjdGlvbmApO1xuICAgICAgICAgICAgdHguZGVzY3JpcHRpb24gPSAnVW5uYW1lZCB0cmFuc2FjdGlvbic7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KVxuICAgICAgICAubWFwKHR4ID0+IHtcbiAgICAgICAgICAvLyBFbnN1cmUgdGhlIGRhdGUgaXMgcHJvcGVybHkgZm9ybWF0dGVkXG4gICAgICAgICAgbGV0IGRhdGU7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGRhdGUgPSBuZXcgRGF0ZSh0eC5kYXRlKTtcbiAgICAgICAgICAgIGlmIChpc05hTihkYXRlLmdldFRpbWUoKSkpIHtcbiAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBVc2luZyB0b2RheSdzIGRhdGUgZm9yOiAke3R4LmRlc2NyaXB0aW9ufWApO1xuICAgICAgICAgICAgICBkYXRlID0gbmV3IERhdGUoKTsgLy8gVXNlIHRvZGF5J3MgZGF0ZSBpZiBpbnZhbGlkXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYFVzaW5nIHRvZGF5J3MgZGF0ZSBkdWUgdG8gZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgICAgICAgZGF0ZSA9IG5ldyBEYXRlKCk7IC8vIFVzZSB0b2RheSdzIGRhdGUgaWYgdGhlcmUncyBhbiBlcnJvclxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBFbnN1cmUgYW1vdW50IGlzIGEgdmFsaWQgbnVtYmVyXG4gICAgICAgICAgY29uc3QgYW1vdW50ID0gdHlwZW9mIHR4LmFtb3VudCA9PT0gJ251bWJlcicgPyB0eC5hbW91bnQgOiBwYXJzZUZsb2F0KHR4LmFtb3VudCk7XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRhdGU6IGRhdGUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogU3RyaW5nKHR4LmRlc2NyaXB0aW9uKS5zdWJzdHJpbmcoMCwgMjU1KSwgLy8gTGltaXQgZGVzY3JpcHRpb24gbGVuZ3RoXG4gICAgICAgICAgICBhbW91bnQ6IGlzTmFOKGFtb3VudCkgPyAwIDogYW1vdW50LFxuICAgICAgICAgICAgdHlwZTogdHgudHlwZSA9PT0gJ0lOQ09NRScgPyAnSU5DT01FJyA6ICdFWFBFTlNFJyxcbiAgICAgICAgICAgIGNhdGVnb3J5SWQ6IGRlZmF1bHRDYXRlZ29yeS5pZCxcbiAgICAgICAgICAgIHVzZXJJZDogZGVmYXVsdFVzZXIuaWRcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gRW5zdXJlIHdlIGhhdmUgYXQgbGVhc3Qgb25lIHRyYW5zYWN0aW9uXG4gICAgICBpZiAodmFsaWRUcmFuc2FjdGlvbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignTm8gdmFsaWQgdHJhbnNhY3Rpb25zIGZvdW5kLCBhZGRpbmcgYSBkZWZhdWx0IHRyYW5zYWN0aW9uJyk7XG4gICAgICAgIHZhbGlkVHJhbnNhY3Rpb25zLnB1c2goe1xuICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdEZWZhdWx0IHRyYW5zYWN0aW9uIChubyB2YWxpZCB0cmFuc2FjdGlvbnMgZGV0ZWN0ZWQpJyxcbiAgICAgICAgICBhbW91bnQ6IDEwMCxcbiAgICAgICAgICB0eXBlOiAnRVhQRU5TRScsXG4gICAgICAgICAgY2F0ZWdvcnlJZDogZGVmYXVsdENhdGVnb3J5LmlkLFxuICAgICAgICAgIHVzZXJJZDogZGVmYXVsdFVzZXIuaWRcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGRvY3VtZW50ID0gYXdhaXQgcHJpc21hLmRvY3VtZW50LmNyZWF0ZSh7XG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBmaWxlTmFtZTogdmFsaWRhdGVkRGF0YS5maWxlTmFtZSxcbiAgICAgICAgICBmaWxlVHlwZTogZmlsZS5taW1ldHlwZSxcbiAgICAgICAgICBmaWxlU2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgIHN0YXR1czogJ0NPTVBMRVRFRCcsXG4gICAgICAgICAgdXNlcklkOiBkZWZhdWx0VXNlci5pZCxcbiAgICAgICAgICB0cmFuc2FjdGlvbnM6IHtcbiAgICAgICAgICAgIGNyZWF0ZTogdmFsaWRUcmFuc2FjdGlvbnNcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICB0cmFuc2FjdGlvbnM6IHRydWVcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZygnRG9jdW1lbnQgYW5kIHRyYW5zYWN0aW9ucyBzYXZlZCBzdWNjZXNzZnVsbHknKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzYXZpbmcgdG8gZGF0YWJhc2U6JywgZXJyb3IpO1xuICAgICAgXG4gICAgICAvLyBUcnkgdG8gY3JlYXRlIGRvY3VtZW50IHdpdGhvdXQgdHJhbnNhY3Rpb25zIGlmIHRoYXQncyBjYXVzaW5nIHRoZSBlcnJvclxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc29sZS5sb2coJ0F0dGVtcHRpbmcgdG8gc2F2ZSBkb2N1bWVudCB3aXRob3V0IHRyYW5zYWN0aW9ucy4uLicpO1xuICAgICAgICBkb2N1bWVudCA9IGF3YWl0IHByaXNtYS5kb2N1bWVudC5jcmVhdGUoe1xuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIGZpbGVOYW1lOiB2YWxpZGF0ZWREYXRhLmZpbGVOYW1lLFxuICAgICAgICAgICAgZmlsZVR5cGU6IGZpbGUubWltZXR5cGUsXG4gICAgICAgICAgICBmaWxlU2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgICAgc3RhdHVzOiAnQ09NUExFVEVEJyxcbiAgICAgICAgICAgIHVzZXJJZDogZGVmYXVsdFVzZXIuaWRcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zb2xlLmxvZygnRG9jdW1lbnQgc2F2ZWQgd2l0aG91dCB0cmFuc2FjdGlvbnMnKTtcbiAgICAgIH0gY2F0Y2ggKGZhbGxiYWNrRXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2F2ZSBkb2N1bWVudCB3aXRob3V0IHRyYW5zYWN0aW9uczonLCBmYWxsYmFja0Vycm9yKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gc2F2ZSBkb2N1bWVudCBhbmQgdHJhbnNhY3Rpb25zIHRvIGRhdGFiYXNlJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgIGRvY3VtZW50LFxuICAgICAgYW5hbHlzaXM6IHtcbiAgICAgICAgc3VtbWFyeTogYW5hbHlzaXMuc3VtbWFyeSxcbiAgICAgICAgdHJhbnNhY3Rpb25zOiBkb2N1bWVudD8udHJhbnNhY3Rpb25zIHx8IFtdXG4gICAgICB9XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIGRvY3VtZW50OicsIGVycm9yKTtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBcbiAgICAgICAgZXJyb3I6ICdJbnZhbGlkIGlucHV0IGRhdGEnLFxuICAgICAgICBkZXRhaWxzOiBlcnJvci5lcnJvcnMubWFwKGVyciA9PiAoe1xuICAgICAgICAgIHBhdGg6IGVyci5wYXRoLmpvaW4oJy4nKSxcbiAgICAgICAgICBtZXNzYWdlOiBlcnIubWVzc2FnZVxuICAgICAgICB9KSlcbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvLyBMb2cgdGhlIGZ1bGwgZXJyb3Igc3RhY2sgZm9yIGRlYnVnZ2luZ1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzdGFjazonLCBlcnJvci5zdGFjayk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxuICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gcHJvY2VzcyBkb2N1bWVudCcsXG4gICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIHN0YWNrOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyAmJiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2sgOiB1bmRlZmluZWRcbiAgICB9KTtcbiAgfVxufSAiXSwibmFtZXMiOlsiYW5hbHl6ZUZpbmFuY2lhbERvY3VtZW50IiwicHJpc21hIiwieiIsImZvcm1pZGFibGUiLCJjcmVhdGVSZWFkU3RyZWFtIiwiam9pbiIsIm1rZGlyIiwid3JpdGVGaWxlIiwiY3JlYXRlV29ya2VyIiwiUFNNIiwidXBsb2FkU2NoZW1hIiwib2JqZWN0IiwiZmlsZSIsImFueSIsImZpbGVOYW1lIiwic3RyaW5nIiwiZG9jdW1lbnRUeXBlIiwiZW51bSIsImNvbmZpZyIsImFwaSIsImJvZHlQYXJzZXIiLCJjbGVhblRleHQiLCJ0ZXh0IiwicmVwbGFjZW1lbnRzIiwiT2JqZWN0IiwiZW50cmllcyIsImZvckVhY2giLCJ3cm9uZyIsImNvcnJlY3QiLCJyZXBsYWNlIiwiUmVnRXhwIiwiZXh0cmFjdFRleHRGcm9tRmlsZSIsImZpbGVQYXRoIiwibWltZVR5cGUiLCJzdGFydHNXaXRoIiwid29ya2VyQ29uZmlnIiwidGVzc2VkaXRfY2hhcl93aGl0ZWxpc3QiLCJ0ZXNzZWRpdF9wYWdlc2VnX21vZGUiLCJTSU5HTEVfQkxPQ0siLCJ3b3JrZXIiLCJyZWluaXRpYWxpemUiLCJzZXRQYXJhbWV0ZXJzIiwiZGF0YSIsImNvbmZpZGVuY2UiLCJyZWNvZ25pemUiLCJjb25zb2xlIiwibG9nIiwid2FybiIsImVycm9yIiwiRXJyb3IiLCJtZXNzYWdlIiwidGVybWluYXRlIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsInN0YXR1cyIsImpzb24iLCJmb3JtRGF0YSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZm9ybSIsImtlZXBFeHRlbnNpb25zIiwibWF4RmlsZVNpemUiLCJtYXhGaWVsZHNTaXplIiwibXVsdGlwbGVzIiwicGFyc2UiLCJlcnIiLCJmaWVsZHMiLCJmaWxlcyIsIm9yaWdpbmFsRmlsZW5hbWUiLCJtaW1ldHlwZSIsInNpemUiLCJmaWxlcGF0aCIsInZhbGlkYXRlZERhdGEiLCJ1cGxvYWREaXIiLCJwcm9jZXNzIiwiY3dkIiwicmVjdXJzaXZlIiwibmV3RmlsZW5hbWUiLCJmaWxlQnVmZmVyIiwiY2h1bmtzIiwib24iLCJjaHVuayIsInB1c2giLCJCdWZmZXIiLCJmcm9tIiwiY29uY2F0IiwiYW5hbHlzaXMiLCJkZWZhdWx0VXNlciIsInVzZXIiLCJmaW5kRmlyc3QiLCJ3aGVyZSIsImVtYWlsIiwiY3JlYXRlIiwibmFtZSIsImRlZmF1bHRDYXRlZ29yeSIsImNhdGVnb3J5IiwidXNlcklkIiwiaWQiLCJ0eXBlIiwiY3JlYXRlRXJyb3IiLCJpbmNsdWRlcyIsImRvY3VtZW50IiwiSlNPTiIsInN0cmluZ2lmeSIsInRyYW5zYWN0aW9ucyIsInZhbGlkVHJhbnNhY3Rpb25zIiwiZmlsdGVyIiwidHgiLCJhbW91bnQiLCJpc05hTiIsImRlc2NyaXB0aW9uIiwiZGF0ZSIsIkRhdGUiLCJnZXRUaW1lIiwidG9JU09TdHJpbmciLCJzcGxpdCIsImUiLCJtYXAiLCJwYXJzZUZsb2F0IiwiU3RyaW5nIiwic3Vic3RyaW5nIiwiY2F0ZWdvcnlJZCIsImxlbmd0aCIsImZpbGVUeXBlIiwiZmlsZVNpemUiLCJpbmNsdWRlIiwiZmFsbGJhY2tFcnJvciIsInN1bW1hcnkiLCJab2RFcnJvciIsImRldGFpbHMiLCJlcnJvcnMiLCJwYXRoIiwic3RhY2siLCJ1bmRlZmluZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/documents/upload.ts\n");

/***/ }),

/***/ "(api)/./src/utils/gemini.ts":
/*!*****************************!*\
  !*** ./src/utils/gemini.ts ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   analyzeFinancialDocument: () => (/* binding */ analyzeFinancialDocument)\n/* harmony export */ });\n/* harmony import */ var _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @google/generative-ai */ \"@google/generative-ai\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_google_generative_ai__WEBPACK_IMPORTED_MODULE_0__]);\n_google_generative_ai__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n// Initialize the Gemini client with proper error handling\nconst apiKey = \"AIzaSyAuF2srEDs_ZCRFDpZKPZDjT3RIqATeQJ8\";\nif (!apiKey) {\n    throw new Error(\"NEXT_PUBLIC_GEMINI_API_KEY environment variable is not set\");\n}\nconst genAI = new _google_generative_ai__WEBPACK_IMPORTED_MODULE_0__.GoogleGenerativeAI(apiKey);\nasync function analyzeFinancialDocument(text) {\n    try {\n        console.log(\"Raw text for analysis:\", text.substring(0, 500) + (text.length > 500 ? \"...\" : \"\"));\n        if (!text || text.trim().length < 10) {\n            console.error(\"Text is too short for analysis:\", text);\n            return {\n                transactions: [],\n                summary: {\n                    totalIncome: 0,\n                    totalExpense: 0,\n                    netSavings: 0\n                },\n                categories: [],\n                financialScore: {\n                    score: 0,\n                    status: \"POOR\",\n                    metrics: {\n                        savingsRate: 0,\n                        expenseDistribution: 0,\n                        incomeStability: 0,\n                        debtToIncome: 0\n                    },\n                    recommendations: [\n                        \"Insufficient data for analysis\"\n                    ]\n                },\n                documentType: \"OTHER\"\n            };\n        }\n        // Detect document type\n        let documentType = \"OTHER\";\n        // Check document type from metadata if available\n        const docTypeMatch = text.match(/DOCUMENT_TYPE:\\s*([A-Z_]+)/);\n        if (docTypeMatch && docTypeMatch[1]) {\n            const detectedType = docTypeMatch[1].trim();\n            if ([\n                \"BANK_STATEMENT\",\n                \"UTILITY_BILL\",\n                \"SALARY_SLIP\",\n                \"FORM_16\",\n                \"CHECK\"\n            ].includes(detectedType)) {\n                documentType = detectedType;\n            }\n        } else {\n            // Fallback detection\n            if (text.toLowerCase().includes(\"salary\") && (text.toLowerCase().includes(\"slip\") || text.toLowerCase().includes(\"pay\"))) {\n                documentType = \"SALARY_SLIP\";\n            } else if (text.toLowerCase().includes(\"form\") && (text.toLowerCase().includes(\"16\") || text.toLowerCase().includes(\"tax\") || text.toLowerCase().includes(\"income\"))) {\n                documentType = \"FORM_16\";\n            } else if (text.toLowerCase().includes(\"cheque\") || text.toLowerCase().includes(\"check\")) {\n                documentType = \"CHECK\";\n            } else if (text.toLowerCase().includes(\"bill\") || text.toLowerCase().includes(\"utility\") || text.toLowerCase().includes(\"electricity\") || text.toLowerCase().includes(\"water\") || text.toLowerCase().includes(\"gas\")) {\n                documentType = \"UTILITY_BILL\";\n            } else if (text.toLowerCase().includes(\"statement\") || text.toLowerCase().includes(\"account\") || text.toLowerCase().includes(\"transaction\")) {\n                documentType = \"BANK_STATEMENT\";\n            }\n        }\n        const model = genAI.getGenerativeModel({\n            model: \"gemini-2.0-flash\"\n        });\n        let prompt;\n        // Customize prompt based on document type\n        if (documentType === \"FORM_16\") {\n            prompt = `\n        You are a tax document analyzer. Analyze the following Form 16 or tax certificate and extract all financial information.\n        \n        Look for:\n        1. Salary details\n        2. Tax deducted at source (TDS)\n        3. Any allowances or deductions\n        4. Total income\n        5. Net taxable income\n        \n        Return ONLY a valid JSON object with the following structure (no markdown formatting, no additional text):\n        {\n          \"transactions\": [\n            {\n              \"date\": \"YYYY-MM-DD\", (use the financial year end date if specific date not available)\n              \"description\": \"detailed description of the income/deduction item\",\n              \"amount\": number,\n              \"category\": \"Salary/TDS/Allowance/Deduction\",\n              \"type\": \"INCOME\" or \"EXPENSE\" (TDS and deductions are EXPENSE, salary and allowances are INCOME)\n            }\n          ],\n          \"summary\": {\n            \"totalIncome\": number,\n            \"totalExpense\": number,\n            \"netSavings\": number\n          },\n          \"categories\": [\n            {\n              \"name\": \"category name\",\n              \"amount\": number,\n              \"percentage\": number\n            }\n          ],\n          \"financialScore\": {\n            \"score\": number (0-100),\n            \"status\": \"EXCELLENT\" or \"GOOD\" or \"FAIR\" or \"POOR\",\n            \"metrics\": {\n              \"savingsRate\": number (percentage of income saved),\n              \"expenseDistribution\": number (0-100, measure of how well distributed expenses are),\n              \"incomeStability\": number (0-100, measure of income stability),\n              \"debtToIncome\": number (debt to income ratio if available)\n            },\n            \"recommendations\": [\n              \"string recommendation 1\",\n              \"string recommendation 2\"\n            ]\n          },\n          \"monthlyData\": [\n            {\n              \"month\": \"YYYY-MM\",\n              \"income\": number,\n              \"expense\": number,\n              \"savings\": number\n            }\n          ]\n        }\n\n        Document text:\n        ${text}\n      `;\n        } else if (documentType === \"SALARY_SLIP\") {\n            prompt = `\n        You are a salary slip analyzer. Analyze the following salary slip and extract all financial information.\n        \n        Look for:\n        1. Basic salary\n        2. Allowances (HRA, DA, TA, etc.)\n        3. Deductions (PF, TDS, etc.)\n        4. Gross salary\n        5. Net salary\n        \n        Return ONLY a valid JSON object with the following structure (no markdown formatting, no additional text):\n        {\n          \"transactions\": [\n            {\n              \"date\": \"YYYY-MM-DD\", (use the salary month date if available)\n              \"description\": \"detailed description of the salary component\",\n              \"amount\": number,\n              \"category\": \"Basic/HRA/DA/TA/PF/TDS/etc.\",\n              \"type\": \"INCOME\" or \"EXPENSE\" (deductions are EXPENSE, earnings are INCOME)\n            }\n          ],\n          \"summary\": {\n            \"totalIncome\": number,\n            \"totalExpense\": number,\n            \"netSavings\": number\n          },\n          \"categories\": [\n            {\n              \"name\": \"category name\",\n              \"amount\": number,\n              \"percentage\": number\n            }\n          ],\n          \"financialScore\": {\n            \"score\": number (0-100),\n            \"status\": \"EXCELLENT\" or \"GOOD\" or \"FAIR\" or \"POOR\",\n            \"metrics\": {\n              \"savingsRate\": number (percentage of income saved),\n              \"expenseDistribution\": number (0-100, measure of how well distributed expenses are),\n              \"incomeStability\": number (0-100, measure of income stability),\n              \"debtToIncome\": number (debt to income ratio if available)\n            },\n            \"recommendations\": [\n              \"string recommendation 1\",\n              \"string recommendation 2\"\n            ]\n          }\n        }\n\n        Document text:\n        ${text}\n      `;\n        } else if (documentType === \"UTILITY_BILL\") {\n            prompt = `\n        You are a utility bill analyzer. Analyze the following utility bill and extract all financial information.\n        \n        Look for:\n        1. Bill amount\n        2. Due date\n        3. Previous balance\n        4. Current charges\n        5. Any taxes or fees\n        \n        Return ONLY a valid JSON object with the following structure (no markdown formatting, no additional text):\n        {\n          \"transactions\": [\n            {\n              \"date\": \"YYYY-MM-DD\", (use the bill date or due date)\n              \"description\": \"detailed description of the charge\",\n              \"amount\": number,\n              \"category\": \"Electricity/Water/Gas/Internet/Phone/etc.\",\n              \"type\": \"EXPENSE\"\n            }\n          ],\n          \"summary\": {\n            \"totalIncome\": number,\n            \"totalExpense\": number,\n            \"netSavings\": number\n          },\n          \"categories\": [\n            {\n              \"name\": \"category name\",\n              \"amount\": number,\n              \"percentage\": number\n            }\n          ],\n          \"financialScore\": {\n            \"score\": number (0-100),\n            \"status\": \"EXCELLENT\" or \"GOOD\" or \"FAIR\" or \"POOR\",\n            \"metrics\": {\n              \"savingsRate\": 0,\n              \"expenseDistribution\": number (0-100, measure of how well distributed expenses are),\n              \"incomeStability\": 0,\n              \"debtToIncome\": 0\n            },\n            \"recommendations\": [\n              \"string recommendation 1\",\n              \"string recommendation 2\"\n            ]\n          }\n        }\n\n        Document text:\n        ${text}\n      `;\n        } else if (documentType === \"CHECK\") {\n            prompt = `\n        You are a check/cheque analyzer. Analyze the following check and extract all financial information.\n        \n        Look for:\n        1. Check amount\n        2. Date\n        3. Payee\n        4. Check number\n        \n        Return ONLY a valid JSON object with the following structure (no markdown formatting, no additional text):\n        {\n          \"transactions\": [\n            {\n              \"date\": \"YYYY-MM-DD\", (use the check date)\n              \"description\": \"Payment to [payee]\",\n              \"amount\": number,\n              \"category\": \"Check Payment\",\n              \"type\": \"EXPENSE\"\n            }\n          ],\n          \"summary\": {\n            \"totalIncome\": 0,\n            \"totalExpense\": number,\n            \"netSavings\": -number\n          },\n          \"categories\": [\n            {\n              \"name\": \"Check Payment\",\n              \"amount\": number,\n              \"percentage\": 100\n            }\n          ],\n          \"financialScore\": {\n            \"score\": 50,\n            \"status\": \"FAIR\",\n            \"metrics\": {\n              \"savingsRate\": 0,\n              \"expenseDistribution\": 0,\n              \"incomeStability\": 0,\n              \"debtToIncome\": 0\n            },\n            \"recommendations\": [\n              \"Insufficient data for detailed recommendations\"\n            ]\n          }\n        }\n\n        Document text:\n        ${text}\n      `;\n        } else {\n            // Bank statement or other document types\n            prompt = `\n        You are a financial document analyzer. Analyze the following financial document text and extract ALL transactions.\n        Even if the text is messy or incomplete, try to identify any possible transactions.\n        Look for patterns like dates, descriptions, and amounts.\n        \n        For amounts, look for numbers that appear to be currency values (they may have  or other currency symbols).\n        For dates, look for any date formats (MM/DD/YYYY, DD-MM-YYYY, etc.).\n        For descriptions, look for text near the dates and amounts that describes the transaction.\n        \n        If you can't find specific categories, use \"Uncategorized\".\n        If you can't determine if it's income or expense, default to \"EXPENSE\".\n        \n        Return ONLY a valid JSON object with the following structure (no markdown formatting, no additional text):\n        {\n          \"transactions\": [\n            {\n              \"date\": \"YYYY-MM-DD\", (use today's date if unclear)\n              \"description\": \"description of transaction\",\n              \"amount\": number,\n              \"category\": \"category of transaction (e.g., Food, Transport, Salary)\",\n              \"type\": \"INCOME\" or \"EXPENSE\"\n            }\n          ],\n          \"summary\": {\n            \"totalIncome\": number,\n            \"totalExpense\": number,\n            \"netSavings\": number\n          },\n          \"categories\": [\n            {\n              \"name\": \"category name\",\n              \"amount\": number,\n              \"percentage\": number\n            }\n          ],\n          \"financialScore\": {\n            \"score\": number (0-100),\n            \"status\": \"EXCELLENT\" or \"GOOD\" or \"FAIR\" or \"POOR\",\n            \"metrics\": {\n              \"savingsRate\": number (percentage of income saved),\n              \"expenseDistribution\": number (0-100, measure of how well distributed expenses are),\n              \"incomeStability\": number (0-100, measure of income stability),\n              \"debtToIncome\": number (debt to income ratio if available)\n            },\n            \"recommendations\": [\n              \"string recommendation 1\",\n              \"string recommendation 2\"\n            ]\n          },\n          \"monthlyData\": [\n            {\n              \"month\": \"YYYY-MM\",\n              \"income\": number,\n              \"expense\": number,\n              \"savings\": number\n            }\n          ]\n        }\n\n        Document text:\n        ${text}\n      `;\n        }\n        try {\n            const result = await model.generateContent(prompt);\n            const responseText = result.response.text();\n            // Try to parse the JSON response\n            try {\n                // Extract JSON from the response if it's wrapped in markdown code blocks\n                let jsonText = responseText;\n                const jsonMatch = responseText.match(/```(?:json)?([\\s\\S]*?)```/);\n                if (jsonMatch && jsonMatch[1]) {\n                    jsonText = jsonMatch[1].trim();\n                }\n                const analysis = JSON.parse(jsonText);\n                // Ensure all required properties exist\n                if (!analysis.transactions) analysis.transactions = [];\n                if (!analysis.summary) {\n                    analysis.summary = {\n                        totalIncome: 0,\n                        totalExpense: 0,\n                        netSavings: 0\n                    };\n                }\n                if (!analysis.categories) analysis.categories = [];\n                // Add financial score if not present\n                if (!analysis.financialScore) {\n                    // Calculate financial score\n                    const savingsRate = analysis.summary.totalIncome > 0 ? analysis.summary.netSavings / analysis.summary.totalIncome * 100 : 0;\n                    let score = 0;\n                    let status = \"POOR\";\n                    // Simple scoring algorithm\n                    if (savingsRate >= 30) {\n                        score = 90; // Excellent savings rate\n                        status = \"EXCELLENT\";\n                    } else if (savingsRate >= 20) {\n                        score = 80; // Good savings rate\n                        status = \"GOOD\";\n                    } else if (savingsRate >= 10) {\n                        score = 60; // Fair savings rate\n                        status = \"FAIR\";\n                    } else if (savingsRate > 0) {\n                        score = 40; // Poor but positive savings rate\n                        status = \"POOR\";\n                    } else {\n                        score = 20; // Negative savings rate\n                        status = \"POOR\";\n                    }\n                    // Calculate expense distribution score (how diversified expenses are)\n                    const expenseDistribution = analysis.categories.length > 1 ? Math.min(100, analysis.categories.length * 10) : 0;\n                    // Calculate income stability (if there are multiple income transactions)\n                    const incomeTransactions = analysis.transactions.filter((t)=>t.type === \"INCOME\");\n                    const incomeStability = incomeTransactions.length > 1 ? 80 : 50; // Simple heuristic\n                    analysis.financialScore = {\n                        score,\n                        status,\n                        metrics: {\n                            savingsRate,\n                            expenseDistribution,\n                            incomeStability,\n                            debtToIncome: 0 // Default, as we don't have debt information\n                        },\n                        recommendations: []\n                    };\n                    // Add recommendations based on score\n                    if (savingsRate < 10) {\n                        analysis.financialScore.recommendations.push(\"Increase your savings rate to at least 10% of income\");\n                    }\n                    if (savingsRate < 0) {\n                        analysis.financialScore.recommendations.push(\"Your expenses exceed your income. Consider reducing non-essential expenses\");\n                    }\n                    if (expenseDistribution < 50) {\n                        analysis.financialScore.recommendations.push(\"Diversify your expenses across more categories for better financial health\");\n                    }\n                }\n                // Add document type\n                analysis.documentType = documentType;\n                // Generate monthly data if not present\n                if (!analysis.monthlyData && analysis.transactions.length > 0) {\n                    const monthlyMap = new Map();\n                    analysis.transactions.forEach((tx)=>{\n                        try {\n                            const date = new Date(tx.date);\n                            const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, \"0\")}`;\n                            if (!monthlyMap.has(monthKey)) {\n                                monthlyMap.set(monthKey, {\n                                    income: 0,\n                                    expense: 0,\n                                    savings: 0\n                                });\n                            }\n                            const monthData = monthlyMap.get(monthKey);\n                            if (tx.type === \"INCOME\") {\n                                monthData.income += tx.amount;\n                            } else {\n                                monthData.expense += tx.amount;\n                            }\n                            monthData.savings = monthData.income - monthData.expense;\n                        } catch (e) {\n                            console.error(\"Error processing transaction date:\", e);\n                        }\n                    });\n                    // Convert map to array and sort by month\n                    analysis.monthlyData = Array.from(monthlyMap.entries()).map(([month, data])=>({\n                            month,\n                            ...data\n                        })).sort((a, b)=>a.month.localeCompare(b.month));\n                }\n                return analysis;\n            } catch (parseError) {\n                console.error(\"Error parsing Gemini response:\", parseError);\n                console.error(\"Invalid JSON response:\", responseText);\n                // Return a default structure with appropriate dummy transactions\n                const today = new Date().toISOString().split(\"T\")[0];\n                // Create a default analysis result with financial score\n                const defaultAnalysis = {\n                    transactions: [\n                        {\n                            date: today,\n                            description: \"Error parsing response - sample transaction\",\n                            amount: 100,\n                            category: \"Other\",\n                            type: \"EXPENSE\"\n                        }\n                    ],\n                    summary: {\n                        totalIncome: 0,\n                        totalExpense: 100,\n                        netSavings: -100\n                    },\n                    categories: [\n                        {\n                            name: \"Other\",\n                            amount: 100,\n                            percentage: 100\n                        }\n                    ],\n                    financialScore: {\n                        score: 20,\n                        status: \"POOR\",\n                        metrics: {\n                            savingsRate: 0,\n                            expenseDistribution: 0,\n                            incomeStability: 0,\n                            debtToIncome: 0\n                        },\n                        recommendations: [\n                            \"Insufficient data for detailed analysis\",\n                            \"Try uploading a clearer document\"\n                        ]\n                    },\n                    documentType: documentType\n                };\n                return defaultAnalysis;\n            }\n        } catch (error) {\n            console.error(\"Error in Gemini analysis:\", error);\n            // Return a default structure with a dummy transaction\n            const today = new Date().toISOString().split(\"T\")[0];\n            return {\n                transactions: [\n                    {\n                        date: today,\n                        description: \"Error in analysis - sample transaction\",\n                        amount: 100,\n                        category: \"Other\",\n                        type: \"EXPENSE\"\n                    }\n                ],\n                summary: {\n                    totalIncome: 0,\n                    totalExpense: 100,\n                    netSavings: -100\n                },\n                categories: [\n                    {\n                        name: \"Other\",\n                        amount: 100,\n                        percentage: 100\n                    }\n                ],\n                financialScore: {\n                    score: 20,\n                    status: \"POOR\",\n                    metrics: {\n                        savingsRate: 0,\n                        expenseDistribution: 0,\n                        incomeStability: 0,\n                        debtToIncome: 0\n                    },\n                    recommendations: [\n                        \"Error processing document\",\n                        \"Try uploading a clearer document\"\n                    ]\n                },\n                documentType: documentType\n            };\n        }\n    } catch (error) {\n        console.error(\"Error in Gemini analysis:\", error);\n        // Return a default structure with a dummy transaction\n        const today = new Date().toISOString().split(\"T\")[0];\n        return {\n            transactions: [\n                {\n                    date: today,\n                    description: \"Error in analysis - sample transaction\",\n                    amount: 100,\n                    category: \"Other\",\n                    type: \"EXPENSE\"\n                }\n            ],\n            summary: {\n                totalIncome: 0,\n                totalExpense: 100,\n                netSavings: -100\n            },\n            categories: [\n                {\n                    name: \"Other\",\n                    amount: 100,\n                    percentage: 100\n                }\n            ],\n            financialScore: {\n                score: 20,\n                status: \"POOR\",\n                metrics: {\n                    savingsRate: 0,\n                    expenseDistribution: 0,\n                    incomeStability: 0,\n                    debtToIncome: 0\n                },\n                recommendations: [\n                    \"Error processing document\",\n                    \"Try uploading a clearer document\"\n                ]\n            },\n            documentType: \"OTHER\"\n        };\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aEI7b0JBQ0FDLGlCQUFpQjt3QkFDZjt3QkFDQTtxQkFDRDtnQkFDSDtnQkFDQUMsY0FBY0E7WUFDaEI7UUFDRjtJQUNGLEVBQUUsT0FBT2hCLE9BQU87UUFDZEwsUUFBUUssS0FBSyxDQUFDLDZCQUE2QkE7UUFFM0Msc0RBQXNEO1FBQ3RELE1BQU15RSxRQUFRLElBQUkxQixPQUFPMkIsV0FBVyxHQUFHQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDcEQsT0FBTztZQUNMMUUsY0FBYztnQkFBQztvQkFDYjZDLE1BQU0yQjtvQkFDTkksYUFBYTtvQkFDYmpCLFFBQVE7b0JBQ1JrQixVQUFVO29CQUNWdkMsTUFBTTtnQkFDUjthQUFFO1lBQ0ZyQyxTQUFTO2dCQUNQQyxhQUFhO2dCQUNiQyxjQUFjO2dCQUNkQyxZQUFZLENBQUM7WUFDZjtZQUNBQyxZQUFZO2dCQUFDO29CQUNYeUUsTUFBTTtvQkFDTm5CLFFBQVE7b0JBQ1JvQixZQUFZO2dCQUNkO2FBQUU7WUFDRnpFLGdCQUFnQjtnQkFDZEMsT0FBTztnQkFDUEMsUUFBUTtnQkFDUkMsU0FBUztvQkFDUEMsYUFBYTtvQkFDYkMscUJBQXFCO29CQUNyQkMsaUJBQWlCO29CQUNqQkMsY0FBYztnQkFDaEI7Z0JBQ0FDLGlCQUFpQjtvQkFDZjtvQkFDQTtpQkFDRDtZQUNIO1lBQ0FDLGNBQWM7UUFDaEI7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmluYW5jaWFsLWRvYy1pbnRlbGxpZ2VuY2UvLi9zcmMvdXRpbHMvZ2VtaW5pLnRzP2YyNzQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgR29vZ2xlR2VuZXJhdGl2ZUFJIH0gZnJvbSAnQGdvb2dsZS9nZW5lcmF0aXZlLWFpJztcblxuLy8gSW5pdGlhbGl6ZSB0aGUgR2VtaW5pIGNsaWVudCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xuY29uc3QgYXBpS2V5ID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfR0VNSU5JX0FQSV9LRVk7XG5pZiAoIWFwaUtleSkge1xuICB0aHJvdyBuZXcgRXJyb3IoJ05FWFRfUFVCTElDX0dFTUlOSV9BUElfS0VZIGVudmlyb25tZW50IHZhcmlhYmxlIGlzIG5vdCBzZXQnKTtcbn1cblxuY29uc3QgZ2VuQUkgPSBuZXcgR29vZ2xlR2VuZXJhdGl2ZUFJKGFwaUtleSk7XG5cbmludGVyZmFjZSBUcmFuc2FjdGlvbiB7XG4gIGRhdGU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgYW1vdW50OiBudW1iZXI7XG4gIGNhdGVnb3J5OiBzdHJpbmc7XG4gIHR5cGU6ICdJTkNPTUUnIHwgJ0VYUEVOU0UnO1xufVxuXG5pbnRlcmZhY2UgQW5hbHlzaXNSZXN1bHQge1xuICB0cmFuc2FjdGlvbnM6IFRyYW5zYWN0aW9uW107XG4gIHN1bW1hcnk6IHtcbiAgICB0b3RhbEluY29tZTogbnVtYmVyO1xuICAgIHRvdGFsRXhwZW5zZTogbnVtYmVyO1xuICAgIG5ldFNhdmluZ3M6IG51bWJlcjtcbiAgfTtcbiAgY2F0ZWdvcmllczoge1xuICAgIG5hbWU6IHN0cmluZztcbiAgICBhbW91bnQ6IG51bWJlcjtcbiAgICBwZXJjZW50YWdlOiBudW1iZXI7XG4gIH1bXTtcbiAgZmluYW5jaWFsU2NvcmU6IHtcbiAgICBzY29yZTogbnVtYmVyOyAgLy8gMC0xMDAgc2NvcmVcbiAgICBzdGF0dXM6ICdFWENFTExFTlQnIHwgJ0dPT0QnIHwgJ0ZBSVInIHwgJ1BPT1InO1xuICAgIG1ldHJpY3M6IHtcbiAgICAgIHNhdmluZ3NSYXRlOiBudW1iZXI7ICAvLyBQZXJjZW50YWdlIG9mIGluY29tZSBzYXZlZFxuICAgICAgZXhwZW5zZURpc3RyaWJ1dGlvbjogbnVtYmVyOyAgLy8gTWVhc3VyZSBvZiBob3cgd2VsbCBkaXN0cmlidXRlZCBleHBlbnNlcyBhcmVcbiAgICAgIGluY29tZVN0YWJpbGl0eTogbnVtYmVyOyAgLy8gTWVhc3VyZSBvZiBpbmNvbWUgc3RhYmlsaXR5XG4gICAgICBkZWJ0VG9JbmNvbWU6IG51bWJlcjsgIC8vIERlYnQgdG8gaW5jb21lIHJhdGlvIGlmIGF2YWlsYWJsZVxuICAgIH07XG4gICAgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXTtcbiAgfTtcbiAgbW9udGhseURhdGE/OiB7XG4gICAgbW9udGg6IHN0cmluZztcbiAgICBpbmNvbWU6IG51bWJlcjtcbiAgICBleHBlbnNlOiBudW1iZXI7XG4gICAgc2F2aW5nczogbnVtYmVyO1xuICB9W107XG4gIGRvY3VtZW50VHlwZTogJ0JBTktfU1RBVEVNRU5UJyB8ICdVVElMSVRZX0JJTEwnIHwgJ1NBTEFSWV9TTElQJyB8ICdGT1JNXzE2JyB8ICdDSEVDSycgfCAnT1RIRVInO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYW5hbHl6ZUZpbmFuY2lhbERvY3VtZW50KHRleHQ6IHN0cmluZyk6IFByb21pc2U8QW5hbHlzaXNSZXN1bHQ+IHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnUmF3IHRleHQgZm9yIGFuYWx5c2lzOicsIHRleHQuc3Vic3RyaW5nKDAsIDUwMCkgKyAodGV4dC5sZW5ndGggPiA1MDAgPyAnLi4uJyA6ICcnKSk7XG4gICAgXG4gICAgaWYgKCF0ZXh0IHx8IHRleHQudHJpbSgpLmxlbmd0aCA8IDEwKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdUZXh0IGlzIHRvbyBzaG9ydCBmb3IgYW5hbHlzaXM6JywgdGV4dCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0cmFuc2FjdGlvbnM6IFtdLFxuICAgICAgICBzdW1tYXJ5OiB7XG4gICAgICAgICAgdG90YWxJbmNvbWU6IDAsXG4gICAgICAgICAgdG90YWxFeHBlbnNlOiAwLFxuICAgICAgICAgIG5ldFNhdmluZ3M6IDBcbiAgICAgICAgfSxcbiAgICAgICAgY2F0ZWdvcmllczogW10sXG4gICAgICAgIGZpbmFuY2lhbFNjb3JlOiB7XG4gICAgICAgICAgc2NvcmU6IDAsXG4gICAgICAgICAgc3RhdHVzOiAnUE9PUicsXG4gICAgICAgICAgbWV0cmljczoge1xuICAgICAgICAgICAgc2F2aW5nc1JhdGU6IDAsXG4gICAgICAgICAgICBleHBlbnNlRGlzdHJpYnV0aW9uOiAwLFxuICAgICAgICAgICAgaW5jb21lU3RhYmlsaXR5OiAwLFxuICAgICAgICAgICAgZGVidFRvSW5jb21lOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnM6IFsnSW5zdWZmaWNpZW50IGRhdGEgZm9yIGFuYWx5c2lzJ11cbiAgICAgICAgfSxcbiAgICAgICAgZG9jdW1lbnRUeXBlOiAnT1RIRVInXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICAvLyBEZXRlY3QgZG9jdW1lbnQgdHlwZVxuICAgIGxldCBkb2N1bWVudFR5cGUgPSAnT1RIRVInO1xuICAgIFxuICAgIC8vIENoZWNrIGRvY3VtZW50IHR5cGUgZnJvbSBtZXRhZGF0YSBpZiBhdmFpbGFibGVcbiAgICBjb25zdCBkb2NUeXBlTWF0Y2ggPSB0ZXh0Lm1hdGNoKC9ET0NVTUVOVF9UWVBFOlxccyooW0EtWl9dKykvKTtcbiAgICBpZiAoZG9jVHlwZU1hdGNoICYmIGRvY1R5cGVNYXRjaFsxXSkge1xuICAgICAgY29uc3QgZGV0ZWN0ZWRUeXBlID0gZG9jVHlwZU1hdGNoWzFdLnRyaW0oKTtcbiAgICAgIGlmIChbJ0JBTktfU1RBVEVNRU5UJywgJ1VUSUxJVFlfQklMTCcsICdTQUxBUllfU0xJUCcsICdGT1JNXzE2JywgJ0NIRUNLJ10uaW5jbHVkZXMoZGV0ZWN0ZWRUeXBlKSkge1xuICAgICAgICBkb2N1bWVudFR5cGUgPSBkZXRlY3RlZFR5cGU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZhbGxiYWNrIGRldGVjdGlvblxuICAgICAgaWYgKHRleHQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnc2FsYXJ5JykgJiYgXG4gICAgICAgICAgKHRleHQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnc2xpcCcpIHx8IHRleHQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygncGF5JykpKSB7XG4gICAgICAgIGRvY3VtZW50VHlwZSA9ICdTQUxBUllfU0xJUCc7XG4gICAgICB9IGVsc2UgaWYgKHRleHQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnZm9ybScpICYmIFxuICAgICAgICAgICAgICAgICh0ZXh0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJzE2JykgfHwgXG4gICAgICAgICAgICAgICAgIHRleHQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygndGF4JykgfHwgXG4gICAgICAgICAgICAgICAgIHRleHQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnaW5jb21lJykpKSB7XG4gICAgICAgIGRvY3VtZW50VHlwZSA9ICdGT1JNXzE2JztcbiAgICAgIH0gZWxzZSBpZiAodGV4dC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdjaGVxdWUnKSB8fCB0ZXh0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2NoZWNrJykpIHtcbiAgICAgICAgZG9jdW1lbnRUeXBlID0gJ0NIRUNLJztcbiAgICAgIH0gZWxzZSBpZiAodGV4dC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdiaWxsJykgfHwgXG4gICAgICAgICAgICAgICAgdGV4dC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCd1dGlsaXR5JykgfHxcbiAgICAgICAgICAgICAgICB0ZXh0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2VsZWN0cmljaXR5JykgfHxcbiAgICAgICAgICAgICAgICB0ZXh0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3dhdGVyJykgfHxcbiAgICAgICAgICAgICAgICB0ZXh0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2dhcycpKSB7XG4gICAgICAgIGRvY3VtZW50VHlwZSA9ICdVVElMSVRZX0JJTEwnO1xuICAgICAgfSBlbHNlIGlmICh0ZXh0LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3N0YXRlbWVudCcpIHx8IFxuICAgICAgICAgICAgICAgIHRleHQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnYWNjb3VudCcpIHx8XG4gICAgICAgICAgICAgICAgdGV4dC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCd0cmFuc2FjdGlvbicpKSB7XG4gICAgICAgIGRvY3VtZW50VHlwZSA9ICdCQU5LX1NUQVRFTUVOVCc7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGNvbnN0IG1vZGVsID0gZ2VuQUkuZ2V0R2VuZXJhdGl2ZU1vZGVsKHsgbW9kZWw6ICdnZW1pbmktMi4wLWZsYXNoJyB9KTtcblxuICAgIGxldCBwcm9tcHQ7XG4gICAgXG4gICAgLy8gQ3VzdG9taXplIHByb21wdCBiYXNlZCBvbiBkb2N1bWVudCB0eXBlXG4gICAgaWYgKGRvY3VtZW50VHlwZSA9PT0gJ0ZPUk1fMTYnKSB7XG4gICAgICBwcm9tcHQgPSBgXG4gICAgICAgIFlvdSBhcmUgYSB0YXggZG9jdW1lbnQgYW5hbHl6ZXIuIEFuYWx5emUgdGhlIGZvbGxvd2luZyBGb3JtIDE2IG9yIHRheCBjZXJ0aWZpY2F0ZSBhbmQgZXh0cmFjdCBhbGwgZmluYW5jaWFsIGluZm9ybWF0aW9uLlxuICAgICAgICBcbiAgICAgICAgTG9vayBmb3I6XG4gICAgICAgIDEuIFNhbGFyeSBkZXRhaWxzXG4gICAgICAgIDIuIFRheCBkZWR1Y3RlZCBhdCBzb3VyY2UgKFREUylcbiAgICAgICAgMy4gQW55IGFsbG93YW5jZXMgb3IgZGVkdWN0aW9uc1xuICAgICAgICA0LiBUb3RhbCBpbmNvbWVcbiAgICAgICAgNS4gTmV0IHRheGFibGUgaW5jb21lXG4gICAgICAgIFxuICAgICAgICBSZXR1cm4gT05MWSBhIHZhbGlkIEpTT04gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBzdHJ1Y3R1cmUgKG5vIG1hcmtkb3duIGZvcm1hdHRpbmcsIG5vIGFkZGl0aW9uYWwgdGV4dCk6XG4gICAgICAgIHtcbiAgICAgICAgICBcInRyYW5zYWN0aW9uc1wiOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFwiZGF0ZVwiOiBcIllZWVktTU0tRERcIiwgKHVzZSB0aGUgZmluYW5jaWFsIHllYXIgZW5kIGRhdGUgaWYgc3BlY2lmaWMgZGF0ZSBub3QgYXZhaWxhYmxlKVxuICAgICAgICAgICAgICBcImRlc2NyaXB0aW9uXCI6IFwiZGV0YWlsZWQgZGVzY3JpcHRpb24gb2YgdGhlIGluY29tZS9kZWR1Y3Rpb24gaXRlbVwiLFxuICAgICAgICAgICAgICBcImFtb3VudFwiOiBudW1iZXIsXG4gICAgICAgICAgICAgIFwiY2F0ZWdvcnlcIjogXCJTYWxhcnkvVERTL0FsbG93YW5jZS9EZWR1Y3Rpb25cIixcbiAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiSU5DT01FXCIgb3IgXCJFWFBFTlNFXCIgKFREUyBhbmQgZGVkdWN0aW9ucyBhcmUgRVhQRU5TRSwgc2FsYXJ5IGFuZCBhbGxvd2FuY2VzIGFyZSBJTkNPTUUpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXSxcbiAgICAgICAgICBcInN1bW1hcnlcIjoge1xuICAgICAgICAgICAgXCJ0b3RhbEluY29tZVwiOiBudW1iZXIsXG4gICAgICAgICAgICBcInRvdGFsRXhwZW5zZVwiOiBudW1iZXIsXG4gICAgICAgICAgICBcIm5ldFNhdmluZ3NcIjogbnVtYmVyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImNhdGVnb3JpZXNcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBcIm5hbWVcIjogXCJjYXRlZ29yeSBuYW1lXCIsXG4gICAgICAgICAgICAgIFwiYW1vdW50XCI6IG51bWJlcixcbiAgICAgICAgICAgICAgXCJwZXJjZW50YWdlXCI6IG51bWJlclxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgXCJmaW5hbmNpYWxTY29yZVwiOiB7XG4gICAgICAgICAgICBcInNjb3JlXCI6IG51bWJlciAoMC0xMDApLFxuICAgICAgICAgICAgXCJzdGF0dXNcIjogXCJFWENFTExFTlRcIiBvciBcIkdPT0RcIiBvciBcIkZBSVJcIiBvciBcIlBPT1JcIixcbiAgICAgICAgICAgIFwibWV0cmljc1wiOiB7XG4gICAgICAgICAgICAgIFwic2F2aW5nc1JhdGVcIjogbnVtYmVyIChwZXJjZW50YWdlIG9mIGluY29tZSBzYXZlZCksXG4gICAgICAgICAgICAgIFwiZXhwZW5zZURpc3RyaWJ1dGlvblwiOiBudW1iZXIgKDAtMTAwLCBtZWFzdXJlIG9mIGhvdyB3ZWxsIGRpc3RyaWJ1dGVkIGV4cGVuc2VzIGFyZSksXG4gICAgICAgICAgICAgIFwiaW5jb21lU3RhYmlsaXR5XCI6IG51bWJlciAoMC0xMDAsIG1lYXN1cmUgb2YgaW5jb21lIHN0YWJpbGl0eSksXG4gICAgICAgICAgICAgIFwiZGVidFRvSW5jb21lXCI6IG51bWJlciAoZGVidCB0byBpbmNvbWUgcmF0aW8gaWYgYXZhaWxhYmxlKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwicmVjb21tZW5kYXRpb25zXCI6IFtcbiAgICAgICAgICAgICAgXCJzdHJpbmcgcmVjb21tZW5kYXRpb24gMVwiLFxuICAgICAgICAgICAgICBcInN0cmluZyByZWNvbW1lbmRhdGlvbiAyXCJcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9LFxuICAgICAgICAgIFwibW9udGhseURhdGFcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBcIm1vbnRoXCI6IFwiWVlZWS1NTVwiLFxuICAgICAgICAgICAgICBcImluY29tZVwiOiBudW1iZXIsXG4gICAgICAgICAgICAgIFwiZXhwZW5zZVwiOiBudW1iZXIsXG4gICAgICAgICAgICAgIFwic2F2aW5nc1wiOiBudW1iZXJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdXG4gICAgICAgIH1cblxuICAgICAgICBEb2N1bWVudCB0ZXh0OlxuICAgICAgICAke3RleHR9XG4gICAgICBgO1xuICAgIH0gZWxzZSBpZiAoZG9jdW1lbnRUeXBlID09PSAnU0FMQVJZX1NMSVAnKSB7XG4gICAgICBwcm9tcHQgPSBgXG4gICAgICAgIFlvdSBhcmUgYSBzYWxhcnkgc2xpcCBhbmFseXplci4gQW5hbHl6ZSB0aGUgZm9sbG93aW5nIHNhbGFyeSBzbGlwIGFuZCBleHRyYWN0IGFsbCBmaW5hbmNpYWwgaW5mb3JtYXRpb24uXG4gICAgICAgIFxuICAgICAgICBMb29rIGZvcjpcbiAgICAgICAgMS4gQmFzaWMgc2FsYXJ5XG4gICAgICAgIDIuIEFsbG93YW5jZXMgKEhSQSwgREEsIFRBLCBldGMuKVxuICAgICAgICAzLiBEZWR1Y3Rpb25zIChQRiwgVERTLCBldGMuKVxuICAgICAgICA0LiBHcm9zcyBzYWxhcnlcbiAgICAgICAgNS4gTmV0IHNhbGFyeVxuICAgICAgICBcbiAgICAgICAgUmV0dXJuIE9OTFkgYSB2YWxpZCBKU09OIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgc3RydWN0dXJlIChubyBtYXJrZG93biBmb3JtYXR0aW5nLCBubyBhZGRpdGlvbmFsIHRleHQpOlxuICAgICAgICB7XG4gICAgICAgICAgXCJ0cmFuc2FjdGlvbnNcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBcImRhdGVcIjogXCJZWVlZLU1NLUREXCIsICh1c2UgdGhlIHNhbGFyeSBtb250aCBkYXRlIGlmIGF2YWlsYWJsZSlcbiAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBcImRldGFpbGVkIGRlc2NyaXB0aW9uIG9mIHRoZSBzYWxhcnkgY29tcG9uZW50XCIsXG4gICAgICAgICAgICAgIFwiYW1vdW50XCI6IG51bWJlcixcbiAgICAgICAgICAgICAgXCJjYXRlZ29yeVwiOiBcIkJhc2ljL0hSQS9EQS9UQS9QRi9URFMvZXRjLlwiLFxuICAgICAgICAgICAgICBcInR5cGVcIjogXCJJTkNPTUVcIiBvciBcIkVYUEVOU0VcIiAoZGVkdWN0aW9ucyBhcmUgRVhQRU5TRSwgZWFybmluZ3MgYXJlIElOQ09NRSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdLFxuICAgICAgICAgIFwic3VtbWFyeVwiOiB7XG4gICAgICAgICAgICBcInRvdGFsSW5jb21lXCI6IG51bWJlcixcbiAgICAgICAgICAgIFwidG90YWxFeHBlbnNlXCI6IG51bWJlcixcbiAgICAgICAgICAgIFwibmV0U2F2aW5nc1wiOiBudW1iZXJcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiY2F0ZWdvcmllc1wiOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcImNhdGVnb3J5IG5hbWVcIixcbiAgICAgICAgICAgICAgXCJhbW91bnRcIjogbnVtYmVyLFxuICAgICAgICAgICAgICBcInBlcmNlbnRhZ2VcIjogbnVtYmVyXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXSxcbiAgICAgICAgICBcImZpbmFuY2lhbFNjb3JlXCI6IHtcbiAgICAgICAgICAgIFwic2NvcmVcIjogbnVtYmVyICgwLTEwMCksXG4gICAgICAgICAgICBcInN0YXR1c1wiOiBcIkVYQ0VMTEVOVFwiIG9yIFwiR09PRFwiIG9yIFwiRkFJUlwiIG9yIFwiUE9PUlwiLFxuICAgICAgICAgICAgXCJtZXRyaWNzXCI6IHtcbiAgICAgICAgICAgICAgXCJzYXZpbmdzUmF0ZVwiOiBudW1iZXIgKHBlcmNlbnRhZ2Ugb2YgaW5jb21lIHNhdmVkKSxcbiAgICAgICAgICAgICAgXCJleHBlbnNlRGlzdHJpYnV0aW9uXCI6IG51bWJlciAoMC0xMDAsIG1lYXN1cmUgb2YgaG93IHdlbGwgZGlzdHJpYnV0ZWQgZXhwZW5zZXMgYXJlKSxcbiAgICAgICAgICAgICAgXCJpbmNvbWVTdGFiaWxpdHlcIjogbnVtYmVyICgwLTEwMCwgbWVhc3VyZSBvZiBpbmNvbWUgc3RhYmlsaXR5KSxcbiAgICAgICAgICAgICAgXCJkZWJ0VG9JbmNvbWVcIjogbnVtYmVyIChkZWJ0IHRvIGluY29tZSByYXRpbyBpZiBhdmFpbGFibGUpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJyZWNvbW1lbmRhdGlvbnNcIjogW1xuICAgICAgICAgICAgICBcInN0cmluZyByZWNvbW1lbmRhdGlvbiAxXCIsXG4gICAgICAgICAgICAgIFwic3RyaW5nIHJlY29tbWVuZGF0aW9uIDJcIlxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIERvY3VtZW50IHRleHQ6XG4gICAgICAgICR7dGV4dH1cbiAgICAgIGA7XG4gICAgfSBlbHNlIGlmIChkb2N1bWVudFR5cGUgPT09ICdVVElMSVRZX0JJTEwnKSB7XG4gICAgICBwcm9tcHQgPSBgXG4gICAgICAgIFlvdSBhcmUgYSB1dGlsaXR5IGJpbGwgYW5hbHl6ZXIuIEFuYWx5emUgdGhlIGZvbGxvd2luZyB1dGlsaXR5IGJpbGwgYW5kIGV4dHJhY3QgYWxsIGZpbmFuY2lhbCBpbmZvcm1hdGlvbi5cbiAgICAgICAgXG4gICAgICAgIExvb2sgZm9yOlxuICAgICAgICAxLiBCaWxsIGFtb3VudFxuICAgICAgICAyLiBEdWUgZGF0ZVxuICAgICAgICAzLiBQcmV2aW91cyBiYWxhbmNlXG4gICAgICAgIDQuIEN1cnJlbnQgY2hhcmdlc1xuICAgICAgICA1LiBBbnkgdGF4ZXMgb3IgZmVlc1xuICAgICAgICBcbiAgICAgICAgUmV0dXJuIE9OTFkgYSB2YWxpZCBKU09OIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgc3RydWN0dXJlIChubyBtYXJrZG93biBmb3JtYXR0aW5nLCBubyBhZGRpdGlvbmFsIHRleHQpOlxuICAgICAgICB7XG4gICAgICAgICAgXCJ0cmFuc2FjdGlvbnNcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBcImRhdGVcIjogXCJZWVlZLU1NLUREXCIsICh1c2UgdGhlIGJpbGwgZGF0ZSBvciBkdWUgZGF0ZSlcbiAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBcImRldGFpbGVkIGRlc2NyaXB0aW9uIG9mIHRoZSBjaGFyZ2VcIixcbiAgICAgICAgICAgICAgXCJhbW91bnRcIjogbnVtYmVyLFxuICAgICAgICAgICAgICBcImNhdGVnb3J5XCI6IFwiRWxlY3RyaWNpdHkvV2F0ZXIvR2FzL0ludGVybmV0L1Bob25lL2V0Yy5cIixcbiAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiRVhQRU5TRVwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXSxcbiAgICAgICAgICBcInN1bW1hcnlcIjoge1xuICAgICAgICAgICAgXCJ0b3RhbEluY29tZVwiOiBudW1iZXIsXG4gICAgICAgICAgICBcInRvdGFsRXhwZW5zZVwiOiBudW1iZXIsXG4gICAgICAgICAgICBcIm5ldFNhdmluZ3NcIjogbnVtYmVyXG4gICAgICAgICAgfSxcbiAgICAgICAgICBcImNhdGVnb3JpZXNcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBcIm5hbWVcIjogXCJjYXRlZ29yeSBuYW1lXCIsXG4gICAgICAgICAgICAgIFwiYW1vdW50XCI6IG51bWJlcixcbiAgICAgICAgICAgICAgXCJwZXJjZW50YWdlXCI6IG51bWJlclxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgXCJmaW5hbmNpYWxTY29yZVwiOiB7XG4gICAgICAgICAgICBcInNjb3JlXCI6IG51bWJlciAoMC0xMDApLFxuICAgICAgICAgICAgXCJzdGF0dXNcIjogXCJFWENFTExFTlRcIiBvciBcIkdPT0RcIiBvciBcIkZBSVJcIiBvciBcIlBPT1JcIixcbiAgICAgICAgICAgIFwibWV0cmljc1wiOiB7XG4gICAgICAgICAgICAgIFwic2F2aW5nc1JhdGVcIjogMCxcbiAgICAgICAgICAgICAgXCJleHBlbnNlRGlzdHJpYnV0aW9uXCI6IG51bWJlciAoMC0xMDAsIG1lYXN1cmUgb2YgaG93IHdlbGwgZGlzdHJpYnV0ZWQgZXhwZW5zZXMgYXJlKSxcbiAgICAgICAgICAgICAgXCJpbmNvbWVTdGFiaWxpdHlcIjogMCxcbiAgICAgICAgICAgICAgXCJkZWJ0VG9JbmNvbWVcIjogMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwicmVjb21tZW5kYXRpb25zXCI6IFtcbiAgICAgICAgICAgICAgXCJzdHJpbmcgcmVjb21tZW5kYXRpb24gMVwiLFxuICAgICAgICAgICAgICBcInN0cmluZyByZWNvbW1lbmRhdGlvbiAyXCJcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBEb2N1bWVudCB0ZXh0OlxuICAgICAgICAke3RleHR9XG4gICAgICBgO1xuICAgIH0gZWxzZSBpZiAoZG9jdW1lbnRUeXBlID09PSAnQ0hFQ0snKSB7XG4gICAgICBwcm9tcHQgPSBgXG4gICAgICAgIFlvdSBhcmUgYSBjaGVjay9jaGVxdWUgYW5hbHl6ZXIuIEFuYWx5emUgdGhlIGZvbGxvd2luZyBjaGVjayBhbmQgZXh0cmFjdCBhbGwgZmluYW5jaWFsIGluZm9ybWF0aW9uLlxuICAgICAgICBcbiAgICAgICAgTG9vayBmb3I6XG4gICAgICAgIDEuIENoZWNrIGFtb3VudFxuICAgICAgICAyLiBEYXRlXG4gICAgICAgIDMuIFBheWVlXG4gICAgICAgIDQuIENoZWNrIG51bWJlclxuICAgICAgICBcbiAgICAgICAgUmV0dXJuIE9OTFkgYSB2YWxpZCBKU09OIG9iamVjdCB3aXRoIHRoZSBmb2xsb3dpbmcgc3RydWN0dXJlIChubyBtYXJrZG93biBmb3JtYXR0aW5nLCBubyBhZGRpdGlvbmFsIHRleHQpOlxuICAgICAgICB7XG4gICAgICAgICAgXCJ0cmFuc2FjdGlvbnNcIjogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBcImRhdGVcIjogXCJZWVlZLU1NLUREXCIsICh1c2UgdGhlIGNoZWNrIGRhdGUpXG4gICAgICAgICAgICAgIFwiZGVzY3JpcHRpb25cIjogXCJQYXltZW50IHRvIFtwYXllZV1cIixcbiAgICAgICAgICAgICAgXCJhbW91bnRcIjogbnVtYmVyLFxuICAgICAgICAgICAgICBcImNhdGVnb3J5XCI6IFwiQ2hlY2sgUGF5bWVudFwiLFxuICAgICAgICAgICAgICBcInR5cGVcIjogXCJFWFBFTlNFXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdLFxuICAgICAgICAgIFwic3VtbWFyeVwiOiB7XG4gICAgICAgICAgICBcInRvdGFsSW5jb21lXCI6IDAsXG4gICAgICAgICAgICBcInRvdGFsRXhwZW5zZVwiOiBudW1iZXIsXG4gICAgICAgICAgICBcIm5ldFNhdmluZ3NcIjogLW51bWJlclxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJjYXRlZ29yaWVzXCI6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgXCJuYW1lXCI6IFwiQ2hlY2sgUGF5bWVudFwiLFxuICAgICAgICAgICAgICBcImFtb3VudFwiOiBudW1iZXIsXG4gICAgICAgICAgICAgIFwicGVyY2VudGFnZVwiOiAxMDBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdLFxuICAgICAgICAgIFwiZmluYW5jaWFsU2NvcmVcIjoge1xuICAgICAgICAgICAgXCJzY29yZVwiOiA1MCxcbiAgICAgICAgICAgIFwic3RhdHVzXCI6IFwiRkFJUlwiLFxuICAgICAgICAgICAgXCJtZXRyaWNzXCI6IHtcbiAgICAgICAgICAgICAgXCJzYXZpbmdzUmF0ZVwiOiAwLFxuICAgICAgICAgICAgICBcImV4cGVuc2VEaXN0cmlidXRpb25cIjogMCxcbiAgICAgICAgICAgICAgXCJpbmNvbWVTdGFiaWxpdHlcIjogMCxcbiAgICAgICAgICAgICAgXCJkZWJ0VG9JbmNvbWVcIjogMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFwicmVjb21tZW5kYXRpb25zXCI6IFtcbiAgICAgICAgICAgICAgXCJJbnN1ZmZpY2llbnQgZGF0YSBmb3IgZGV0YWlsZWQgcmVjb21tZW5kYXRpb25zXCJcbiAgICAgICAgICAgIF1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBEb2N1bWVudCB0ZXh0OlxuICAgICAgICAke3RleHR9XG4gICAgICBgO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBCYW5rIHN0YXRlbWVudCBvciBvdGhlciBkb2N1bWVudCB0eXBlc1xuICAgICAgcHJvbXB0ID0gYFxuICAgICAgICBZb3UgYXJlIGEgZmluYW5jaWFsIGRvY3VtZW50IGFuYWx5emVyLiBBbmFseXplIHRoZSBmb2xsb3dpbmcgZmluYW5jaWFsIGRvY3VtZW50IHRleHQgYW5kIGV4dHJhY3QgQUxMIHRyYW5zYWN0aW9ucy5cbiAgICAgICAgRXZlbiBpZiB0aGUgdGV4dCBpcyBtZXNzeSBvciBpbmNvbXBsZXRlLCB0cnkgdG8gaWRlbnRpZnkgYW55IHBvc3NpYmxlIHRyYW5zYWN0aW9ucy5cbiAgICAgICAgTG9vayBmb3IgcGF0dGVybnMgbGlrZSBkYXRlcywgZGVzY3JpcHRpb25zLCBhbmQgYW1vdW50cy5cbiAgICAgICAgXG4gICAgICAgIEZvciBhbW91bnRzLCBsb29rIGZvciBudW1iZXJzIHRoYXQgYXBwZWFyIHRvIGJlIGN1cnJlbmN5IHZhbHVlcyAodGhleSBtYXkgaGF2ZSDigrkgb3Igb3RoZXIgY3VycmVuY3kgc3ltYm9scykuXG4gICAgICAgIEZvciBkYXRlcywgbG9vayBmb3IgYW55IGRhdGUgZm9ybWF0cyAoTU0vREQvWVlZWSwgREQtTU0tWVlZWSwgZXRjLikuXG4gICAgICAgIEZvciBkZXNjcmlwdGlvbnMsIGxvb2sgZm9yIHRleHQgbmVhciB0aGUgZGF0ZXMgYW5kIGFtb3VudHMgdGhhdCBkZXNjcmliZXMgdGhlIHRyYW5zYWN0aW9uLlxuICAgICAgICBcbiAgICAgICAgSWYgeW91IGNhbid0IGZpbmQgc3BlY2lmaWMgY2F0ZWdvcmllcywgdXNlIFwiVW5jYXRlZ29yaXplZFwiLlxuICAgICAgICBJZiB5b3UgY2FuJ3QgZGV0ZXJtaW5lIGlmIGl0J3MgaW5jb21lIG9yIGV4cGVuc2UsIGRlZmF1bHQgdG8gXCJFWFBFTlNFXCIuXG4gICAgICAgIFxuICAgICAgICBSZXR1cm4gT05MWSBhIHZhbGlkIEpTT04gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBzdHJ1Y3R1cmUgKG5vIG1hcmtkb3duIGZvcm1hdHRpbmcsIG5vIGFkZGl0aW9uYWwgdGV4dCk6XG4gICAgICAgIHtcbiAgICAgICAgICBcInRyYW5zYWN0aW9uc1wiOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFwiZGF0ZVwiOiBcIllZWVktTU0tRERcIiwgKHVzZSB0b2RheSdzIGRhdGUgaWYgdW5jbGVhcilcbiAgICAgICAgICAgICAgXCJkZXNjcmlwdGlvblwiOiBcImRlc2NyaXB0aW9uIG9mIHRyYW5zYWN0aW9uXCIsXG4gICAgICAgICAgICAgIFwiYW1vdW50XCI6IG51bWJlcixcbiAgICAgICAgICAgICAgXCJjYXRlZ29yeVwiOiBcImNhdGVnb3J5IG9mIHRyYW5zYWN0aW9uIChlLmcuLCBGb29kLCBUcmFuc3BvcnQsIFNhbGFyeSlcIixcbiAgICAgICAgICAgICAgXCJ0eXBlXCI6IFwiSU5DT01FXCIgb3IgXCJFWFBFTlNFXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdLFxuICAgICAgICAgIFwic3VtbWFyeVwiOiB7XG4gICAgICAgICAgICBcInRvdGFsSW5jb21lXCI6IG51bWJlcixcbiAgICAgICAgICAgIFwidG90YWxFeHBlbnNlXCI6IG51bWJlcixcbiAgICAgICAgICAgIFwibmV0U2F2aW5nc1wiOiBudW1iZXJcbiAgICAgICAgICB9LFxuICAgICAgICAgIFwiY2F0ZWdvcmllc1wiOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFwibmFtZVwiOiBcImNhdGVnb3J5IG5hbWVcIixcbiAgICAgICAgICAgICAgXCJhbW91bnRcIjogbnVtYmVyLFxuICAgICAgICAgICAgICBcInBlcmNlbnRhZ2VcIjogbnVtYmVyXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXSxcbiAgICAgICAgICBcImZpbmFuY2lhbFNjb3JlXCI6IHtcbiAgICAgICAgICAgIFwic2NvcmVcIjogbnVtYmVyICgwLTEwMCksXG4gICAgICAgICAgICBcInN0YXR1c1wiOiBcIkVYQ0VMTEVOVFwiIG9yIFwiR09PRFwiIG9yIFwiRkFJUlwiIG9yIFwiUE9PUlwiLFxuICAgICAgICAgICAgXCJtZXRyaWNzXCI6IHtcbiAgICAgICAgICAgICAgXCJzYXZpbmdzUmF0ZVwiOiBudW1iZXIgKHBlcmNlbnRhZ2Ugb2YgaW5jb21lIHNhdmVkKSxcbiAgICAgICAgICAgICAgXCJleHBlbnNlRGlzdHJpYnV0aW9uXCI6IG51bWJlciAoMC0xMDAsIG1lYXN1cmUgb2YgaG93IHdlbGwgZGlzdHJpYnV0ZWQgZXhwZW5zZXMgYXJlKSxcbiAgICAgICAgICAgICAgXCJpbmNvbWVTdGFiaWxpdHlcIjogbnVtYmVyICgwLTEwMCwgbWVhc3VyZSBvZiBpbmNvbWUgc3RhYmlsaXR5KSxcbiAgICAgICAgICAgICAgXCJkZWJ0VG9JbmNvbWVcIjogbnVtYmVyIChkZWJ0IHRvIGluY29tZSByYXRpbyBpZiBhdmFpbGFibGUpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJyZWNvbW1lbmRhdGlvbnNcIjogW1xuICAgICAgICAgICAgICBcInN0cmluZyByZWNvbW1lbmRhdGlvbiAxXCIsXG4gICAgICAgICAgICAgIFwic3RyaW5nIHJlY29tbWVuZGF0aW9uIDJcIlxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgXCJtb250aGx5RGF0YVwiOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIFwibW9udGhcIjogXCJZWVlZLU1NXCIsXG4gICAgICAgICAgICAgIFwiaW5jb21lXCI6IG51bWJlcixcbiAgICAgICAgICAgICAgXCJleHBlbnNlXCI6IG51bWJlcixcbiAgICAgICAgICAgICAgXCJzYXZpbmdzXCI6IG51bWJlclxuICAgICAgICAgICAgfVxuICAgICAgICAgIF1cbiAgICAgICAgfVxuXG4gICAgICAgIERvY3VtZW50IHRleHQ6XG4gICAgICAgICR7dGV4dH1cbiAgICAgIGA7XG4gICAgfVxuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBtb2RlbC5nZW5lcmF0ZUNvbnRlbnQocHJvbXB0KTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlVGV4dCA9IHJlc3VsdC5yZXNwb25zZS50ZXh0KCk7XG4gICAgICBcbiAgICAgIC8vIFRyeSB0byBwYXJzZSB0aGUgSlNPTiByZXNwb25zZVxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gRXh0cmFjdCBKU09OIGZyb20gdGhlIHJlc3BvbnNlIGlmIGl0J3Mgd3JhcHBlZCBpbiBtYXJrZG93biBjb2RlIGJsb2Nrc1xuICAgICAgICBsZXQganNvblRleHQgPSByZXNwb25zZVRleHQ7XG4gICAgICAgIGNvbnN0IGpzb25NYXRjaCA9IHJlc3BvbnNlVGV4dC5tYXRjaCgvYGBgKD86anNvbik/KFtcXHNcXFNdKj8pYGBgLyk7XG4gICAgICAgIGlmIChqc29uTWF0Y2ggJiYganNvbk1hdGNoWzFdKSB7XG4gICAgICAgICAganNvblRleHQgPSBqc29uTWF0Y2hbMV0udHJpbSgpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBhbmFseXNpczogQW5hbHlzaXNSZXN1bHQgPSBKU09OLnBhcnNlKGpzb25UZXh0KTtcbiAgICAgICAgXG4gICAgICAgIC8vIEVuc3VyZSBhbGwgcmVxdWlyZWQgcHJvcGVydGllcyBleGlzdFxuICAgICAgICBpZiAoIWFuYWx5c2lzLnRyYW5zYWN0aW9ucykgYW5hbHlzaXMudHJhbnNhY3Rpb25zID0gW107XG4gICAgICAgIGlmICghYW5hbHlzaXMuc3VtbWFyeSkge1xuICAgICAgICAgIGFuYWx5c2lzLnN1bW1hcnkgPSB7XG4gICAgICAgICAgICB0b3RhbEluY29tZTogMCxcbiAgICAgICAgICAgIHRvdGFsRXhwZW5zZTogMCxcbiAgICAgICAgICAgIG5ldFNhdmluZ3M6IDBcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmICghYW5hbHlzaXMuY2F0ZWdvcmllcykgYW5hbHlzaXMuY2F0ZWdvcmllcyA9IFtdO1xuICAgICAgICBcbiAgICAgICAgLy8gQWRkIGZpbmFuY2lhbCBzY29yZSBpZiBub3QgcHJlc2VudFxuICAgICAgICBpZiAoIWFuYWx5c2lzLmZpbmFuY2lhbFNjb3JlKSB7XG4gICAgICAgICAgLy8gQ2FsY3VsYXRlIGZpbmFuY2lhbCBzY29yZVxuICAgICAgICAgIGNvbnN0IHNhdmluZ3NSYXRlID0gYW5hbHlzaXMuc3VtbWFyeS50b3RhbEluY29tZSA+IDAgXG4gICAgICAgICAgICA/IChhbmFseXNpcy5zdW1tYXJ5Lm5ldFNhdmluZ3MgLyBhbmFseXNpcy5zdW1tYXJ5LnRvdGFsSW5jb21lKSAqIDEwMCBcbiAgICAgICAgICAgIDogMDtcbiAgICAgICAgICBcbiAgICAgICAgICBsZXQgc2NvcmUgPSAwO1xuICAgICAgICAgIGxldCBzdGF0dXM6ICdFWENFTExFTlQnIHwgJ0dPT0QnIHwgJ0ZBSVInIHwgJ1BPT1InID0gJ1BPT1InO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIFNpbXBsZSBzY29yaW5nIGFsZ29yaXRobVxuICAgICAgICAgIGlmIChzYXZpbmdzUmF0ZSA+PSAzMCkge1xuICAgICAgICAgICAgc2NvcmUgPSA5MDsgLy8gRXhjZWxsZW50IHNhdmluZ3MgcmF0ZVxuICAgICAgICAgICAgc3RhdHVzID0gJ0VYQ0VMTEVOVCc7XG4gICAgICAgICAgfSBlbHNlIGlmIChzYXZpbmdzUmF0ZSA+PSAyMCkge1xuICAgICAgICAgICAgc2NvcmUgPSA4MDsgLy8gR29vZCBzYXZpbmdzIHJhdGVcbiAgICAgICAgICAgIHN0YXR1cyA9ICdHT09EJztcbiAgICAgICAgICB9IGVsc2UgaWYgKHNhdmluZ3NSYXRlID49IDEwKSB7XG4gICAgICAgICAgICBzY29yZSA9IDYwOyAvLyBGYWlyIHNhdmluZ3MgcmF0ZVxuICAgICAgICAgICAgc3RhdHVzID0gJ0ZBSVInO1xuICAgICAgICAgIH0gZWxzZSBpZiAoc2F2aW5nc1JhdGUgPiAwKSB7XG4gICAgICAgICAgICBzY29yZSA9IDQwOyAvLyBQb29yIGJ1dCBwb3NpdGl2ZSBzYXZpbmdzIHJhdGVcbiAgICAgICAgICAgIHN0YXR1cyA9ICdQT09SJztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2NvcmUgPSAyMDsgLy8gTmVnYXRpdmUgc2F2aW5ncyByYXRlXG4gICAgICAgICAgICBzdGF0dXMgPSAnUE9PUic7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIENhbGN1bGF0ZSBleHBlbnNlIGRpc3RyaWJ1dGlvbiBzY29yZSAoaG93IGRpdmVyc2lmaWVkIGV4cGVuc2VzIGFyZSlcbiAgICAgICAgICBjb25zdCBleHBlbnNlRGlzdHJpYnV0aW9uID0gYW5hbHlzaXMuY2F0ZWdvcmllcy5sZW5ndGggPiAxID8gXG4gICAgICAgICAgICBNYXRoLm1pbigxMDAsIGFuYWx5c2lzLmNhdGVnb3JpZXMubGVuZ3RoICogMTApIDogMDtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDYWxjdWxhdGUgaW5jb21lIHN0YWJpbGl0eSAoaWYgdGhlcmUgYXJlIG11bHRpcGxlIGluY29tZSB0cmFuc2FjdGlvbnMpXG4gICAgICAgICAgY29uc3QgaW5jb21lVHJhbnNhY3Rpb25zID0gYW5hbHlzaXMudHJhbnNhY3Rpb25zLmZpbHRlcih0ID0+IHQudHlwZSA9PT0gJ0lOQ09NRScpO1xuICAgICAgICAgIGNvbnN0IGluY29tZVN0YWJpbGl0eSA9IGluY29tZVRyYW5zYWN0aW9ucy5sZW5ndGggPiAxID8gODAgOiA1MDsgLy8gU2ltcGxlIGhldXJpc3RpY1xuICAgICAgICAgIFxuICAgICAgICAgIGFuYWx5c2lzLmZpbmFuY2lhbFNjb3JlID0ge1xuICAgICAgICAgICAgc2NvcmUsXG4gICAgICAgICAgICBzdGF0dXMsXG4gICAgICAgICAgICBtZXRyaWNzOiB7XG4gICAgICAgICAgICAgIHNhdmluZ3NSYXRlLFxuICAgICAgICAgICAgICBleHBlbnNlRGlzdHJpYnV0aW9uLFxuICAgICAgICAgICAgICBpbmNvbWVTdGFiaWxpdHksXG4gICAgICAgICAgICAgIGRlYnRUb0luY29tZTogMCAvLyBEZWZhdWx0LCBhcyB3ZSBkb24ndCBoYXZlIGRlYnQgaW5mb3JtYXRpb25cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZWNvbW1lbmRhdGlvbnM6IFtdXG4gICAgICAgICAgfTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBBZGQgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIHNjb3JlXG4gICAgICAgICAgaWYgKHNhdmluZ3NSYXRlIDwgMTApIHtcbiAgICAgICAgICAgIGFuYWx5c2lzLmZpbmFuY2lhbFNjb3JlLnJlY29tbWVuZGF0aW9ucy5wdXNoKCdJbmNyZWFzZSB5b3VyIHNhdmluZ3MgcmF0ZSB0byBhdCBsZWFzdCAxMCUgb2YgaW5jb21lJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzYXZpbmdzUmF0ZSA8IDApIHtcbiAgICAgICAgICAgIGFuYWx5c2lzLmZpbmFuY2lhbFNjb3JlLnJlY29tbWVuZGF0aW9ucy5wdXNoKCdZb3VyIGV4cGVuc2VzIGV4Y2VlZCB5b3VyIGluY29tZS4gQ29uc2lkZXIgcmVkdWNpbmcgbm9uLWVzc2VudGlhbCBleHBlbnNlcycpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZXhwZW5zZURpc3RyaWJ1dGlvbiA8IDUwKSB7XG4gICAgICAgICAgICBhbmFseXNpcy5maW5hbmNpYWxTY29yZS5yZWNvbW1lbmRhdGlvbnMucHVzaCgnRGl2ZXJzaWZ5IHlvdXIgZXhwZW5zZXMgYWNyb3NzIG1vcmUgY2F0ZWdvcmllcyBmb3IgYmV0dGVyIGZpbmFuY2lhbCBoZWFsdGgnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBkb2N1bWVudCB0eXBlXG4gICAgICAgIGFuYWx5c2lzLmRvY3VtZW50VHlwZSA9IGRvY3VtZW50VHlwZSBhcyBhbnk7XG4gICAgICAgIFxuICAgICAgICAvLyBHZW5lcmF0ZSBtb250aGx5IGRhdGEgaWYgbm90IHByZXNlbnRcbiAgICAgICAgaWYgKCFhbmFseXNpcy5tb250aGx5RGF0YSAmJiBhbmFseXNpcy50cmFuc2FjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnN0IG1vbnRobHlNYXAgPSBuZXcgTWFwPHN0cmluZywgeyBpbmNvbWU6IG51bWJlciwgZXhwZW5zZTogbnVtYmVyLCBzYXZpbmdzOiBudW1iZXIgfT4oKTtcbiAgICAgICAgICBcbiAgICAgICAgICBhbmFseXNpcy50cmFuc2FjdGlvbnMuZm9yRWFjaCh0eCA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUodHguZGF0ZSk7XG4gICAgICAgICAgICAgIGNvbnN0IG1vbnRoS2V5ID0gYCR7ZGF0ZS5nZXRGdWxsWWVhcigpfS0ke1N0cmluZyhkYXRlLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpfWA7XG4gICAgICAgICAgICAgIFxuICAgICAgICAgICAgICBpZiAoIW1vbnRobHlNYXAuaGFzKG1vbnRoS2V5KSkge1xuICAgICAgICAgICAgICAgIG1vbnRobHlNYXAuc2V0KG1vbnRoS2V5LCB7IGluY29tZTogMCwgZXhwZW5zZTogMCwgc2F2aW5nczogMCB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgY29uc3QgbW9udGhEYXRhID0gbW9udGhseU1hcC5nZXQobW9udGhLZXkpITtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGlmICh0eC50eXBlID09PSAnSU5DT01FJykge1xuICAgICAgICAgICAgICAgIG1vbnRoRGF0YS5pbmNvbWUgKz0gdHguYW1vdW50O1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vbnRoRGF0YS5leHBlbnNlICs9IHR4LmFtb3VudDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgbW9udGhEYXRhLnNhdmluZ3MgPSBtb250aERhdGEuaW5jb21lIC0gbW9udGhEYXRhLmV4cGVuc2U7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHByb2Nlc3NpbmcgdHJhbnNhY3Rpb24gZGF0ZTonLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDb252ZXJ0IG1hcCB0byBhcnJheSBhbmQgc29ydCBieSBtb250aFxuICAgICAgICAgIGFuYWx5c2lzLm1vbnRobHlEYXRhID0gQXJyYXkuZnJvbShtb250aGx5TWFwLmVudHJpZXMoKSlcbiAgICAgICAgICAgIC5tYXAoKFttb250aCwgZGF0YV0pID0+ICh7IG1vbnRoLCAuLi5kYXRhIH0pKVxuICAgICAgICAgICAgLnNvcnQoKGEsIGIpID0+IGEubW9udGgubG9jYWxlQ29tcGFyZShiLm1vbnRoKSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBhbmFseXNpcztcbiAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgcGFyc2luZyBHZW1pbmkgcmVzcG9uc2U6JywgcGFyc2VFcnJvcik7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ludmFsaWQgSlNPTiByZXNwb25zZTonLCByZXNwb25zZVRleHQpO1xuICAgICAgICBcbiAgICAgICAgLy8gUmV0dXJuIGEgZGVmYXVsdCBzdHJ1Y3R1cmUgd2l0aCBhcHByb3ByaWF0ZSBkdW1teSB0cmFuc2FjdGlvbnNcbiAgICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBhIGRlZmF1bHQgYW5hbHlzaXMgcmVzdWx0IHdpdGggZmluYW5jaWFsIHNjb3JlXG4gICAgICAgIGNvbnN0IGRlZmF1bHRBbmFseXNpczogQW5hbHlzaXNSZXN1bHQgPSB7XG4gICAgICAgICAgdHJhbnNhY3Rpb25zOiBbe1xuICAgICAgICAgICAgZGF0ZTogdG9kYXksXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogXCJFcnJvciBwYXJzaW5nIHJlc3BvbnNlIC0gc2FtcGxlIHRyYW5zYWN0aW9uXCIsXG4gICAgICAgICAgICBhbW91bnQ6IDEwMCxcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcIk90aGVyXCIsXG4gICAgICAgICAgICB0eXBlOiBcIkVYUEVOU0VcIlxuICAgICAgICAgIH1dLFxuICAgICAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgICAgIHRvdGFsSW5jb21lOiAwLFxuICAgICAgICAgICAgdG90YWxFeHBlbnNlOiAxMDAsXG4gICAgICAgICAgICBuZXRTYXZpbmdzOiAtMTAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBjYXRlZ29yaWVzOiBbe1xuICAgICAgICAgICAgbmFtZTogXCJPdGhlclwiLFxuICAgICAgICAgICAgYW1vdW50OiAxMDAsXG4gICAgICAgICAgICBwZXJjZW50YWdlOiAxMDBcbiAgICAgICAgICB9XSxcbiAgICAgICAgICBmaW5hbmNpYWxTY29yZToge1xuICAgICAgICAgICAgc2NvcmU6IDIwLFxuICAgICAgICAgICAgc3RhdHVzOiAnUE9PUicsXG4gICAgICAgICAgICBtZXRyaWNzOiB7XG4gICAgICAgICAgICAgIHNhdmluZ3NSYXRlOiAwLFxuICAgICAgICAgICAgICBleHBlbnNlRGlzdHJpYnV0aW9uOiAwLFxuICAgICAgICAgICAgICBpbmNvbWVTdGFiaWxpdHk6IDAsXG4gICAgICAgICAgICAgIGRlYnRUb0luY29tZTogMFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlY29tbWVuZGF0aW9uczogW1xuICAgICAgICAgICAgICAnSW5zdWZmaWNpZW50IGRhdGEgZm9yIGRldGFpbGVkIGFuYWx5c2lzJyxcbiAgICAgICAgICAgICAgJ1RyeSB1cGxvYWRpbmcgYSBjbGVhcmVyIGRvY3VtZW50J1xuICAgICAgICAgICAgXVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZG9jdW1lbnRUeXBlOiBkb2N1bWVudFR5cGUgYXMgYW55XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZGVmYXVsdEFuYWx5c2lzO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBHZW1pbmkgYW5hbHlzaXM6JywgZXJyb3IpO1xuICAgICAgXG4gICAgICAvLyBSZXR1cm4gYSBkZWZhdWx0IHN0cnVjdHVyZSB3aXRoIGEgZHVtbXkgdHJhbnNhY3Rpb25cbiAgICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF07XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0cmFuc2FjdGlvbnM6IFt7XG4gICAgICAgICAgZGF0ZTogdG9kYXksXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiRXJyb3IgaW4gYW5hbHlzaXMgLSBzYW1wbGUgdHJhbnNhY3Rpb25cIixcbiAgICAgICAgICBhbW91bnQ6IDEwMCxcbiAgICAgICAgICBjYXRlZ29yeTogXCJPdGhlclwiLFxuICAgICAgICAgIHR5cGU6IFwiRVhQRU5TRVwiXG4gICAgICAgIH1dLFxuICAgICAgICBzdW1tYXJ5OiB7XG4gICAgICAgICAgdG90YWxJbmNvbWU6IDAsXG4gICAgICAgICAgdG90YWxFeHBlbnNlOiAxMDAsXG4gICAgICAgICAgbmV0U2F2aW5nczogLTEwMFxuICAgICAgICB9LFxuICAgICAgICBjYXRlZ29yaWVzOiBbe1xuICAgICAgICAgIG5hbWU6IFwiT3RoZXJcIixcbiAgICAgICAgICBhbW91bnQ6IDEwMCxcbiAgICAgICAgICBwZXJjZW50YWdlOiAxMDBcbiAgICAgICAgfV0sXG4gICAgICAgIGZpbmFuY2lhbFNjb3JlOiB7XG4gICAgICAgICAgc2NvcmU6IDIwLFxuICAgICAgICAgIHN0YXR1czogJ1BPT1InLFxuICAgICAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgICAgIHNhdmluZ3NSYXRlOiAwLFxuICAgICAgICAgICAgZXhwZW5zZURpc3RyaWJ1dGlvbjogMCxcbiAgICAgICAgICAgIGluY29tZVN0YWJpbGl0eTogMCxcbiAgICAgICAgICAgIGRlYnRUb0luY29tZTogMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbXG4gICAgICAgICAgICAnRXJyb3IgcHJvY2Vzc2luZyBkb2N1bWVudCcsXG4gICAgICAgICAgICAnVHJ5IHVwbG9hZGluZyBhIGNsZWFyZXIgZG9jdW1lbnQnXG4gICAgICAgICAgXVxuICAgICAgICB9LFxuICAgICAgICBkb2N1bWVudFR5cGU6IGRvY3VtZW50VHlwZSBhcyBhbnlcbiAgICAgIH07XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGluIEdlbWluaSBhbmFseXNpczonLCBlcnJvcik7XG4gICAgXG4gICAgLy8gUmV0dXJuIGEgZGVmYXVsdCBzdHJ1Y3R1cmUgd2l0aCBhIGR1bW15IHRyYW5zYWN0aW9uXG4gICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXTtcbiAgICByZXR1cm4ge1xuICAgICAgdHJhbnNhY3Rpb25zOiBbe1xuICAgICAgICBkYXRlOiB0b2RheSxcbiAgICAgICAgZGVzY3JpcHRpb246IFwiRXJyb3IgaW4gYW5hbHlzaXMgLSBzYW1wbGUgdHJhbnNhY3Rpb25cIixcbiAgICAgICAgYW1vdW50OiAxMDAsXG4gICAgICAgIGNhdGVnb3J5OiBcIk90aGVyXCIsXG4gICAgICAgIHR5cGU6IFwiRVhQRU5TRVwiXG4gICAgICB9XSxcbiAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgdG90YWxJbmNvbWU6IDAsXG4gICAgICAgIHRvdGFsRXhwZW5zZTogMTAwLFxuICAgICAgICBuZXRTYXZpbmdzOiAtMTAwXG4gICAgICB9LFxuICAgICAgY2F0ZWdvcmllczogW3tcbiAgICAgICAgbmFtZTogXCJPdGhlclwiLFxuICAgICAgICBhbW91bnQ6IDEwMCxcbiAgICAgICAgcGVyY2VudGFnZTogMTAwXG4gICAgICB9XSxcbiAgICAgIGZpbmFuY2lhbFNjb3JlOiB7XG4gICAgICAgIHNjb3JlOiAyMCxcbiAgICAgICAgc3RhdHVzOiAnUE9PUicsXG4gICAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgICBzYXZpbmdzUmF0ZTogMCxcbiAgICAgICAgICBleHBlbnNlRGlzdHJpYnV0aW9uOiAwLFxuICAgICAgICAgIGluY29tZVN0YWJpbGl0eTogMCxcbiAgICAgICAgICBkZWJ0VG9JbmNvbWU6IDBcbiAgICAgICAgfSxcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbXG4gICAgICAgICAgJ0Vycm9yIHByb2Nlc3NpbmcgZG9jdW1lbnQnLFxuICAgICAgICAgICdUcnkgdXBsb2FkaW5nIGEgY2xlYXJlciBkb2N1bWVudCdcbiAgICAgICAgXVxuICAgICAgfSxcbiAgICAgIGRvY3VtZW50VHlwZTogJ09USEVSJ1xuICAgIH07XG4gIH1cbn0iXSwibmFtZXMiOlsiR29vZ2xlR2VuZXJhdGl2ZUFJIiwiYXBpS2V5IiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX0dFTUlOSV9BUElfS0VZIiwiRXJyb3IiLCJnZW5BSSIsImFuYWx5emVGaW5hbmNpYWxEb2N1bWVudCIsInRleHQiLCJjb25zb2xlIiwibG9nIiwic3Vic3RyaW5nIiwibGVuZ3RoIiwidHJpbSIsImVycm9yIiwidHJhbnNhY3Rpb25zIiwic3VtbWFyeSIsInRvdGFsSW5jb21lIiwidG90YWxFeHBlbnNlIiwibmV0U2F2aW5ncyIsImNhdGVnb3JpZXMiLCJmaW5hbmNpYWxTY29yZSIsInNjb3JlIiwic3RhdHVzIiwibWV0cmljcyIsInNhdmluZ3NSYXRlIiwiZXhwZW5zZURpc3RyaWJ1dGlvbiIsImluY29tZVN0YWJpbGl0eSIsImRlYnRUb0luY29tZSIsInJlY29tbWVuZGF0aW9ucyIsImRvY3VtZW50VHlwZSIsImRvY1R5cGVNYXRjaCIsIm1hdGNoIiwiZGV0ZWN0ZWRUeXBlIiwiaW5jbHVkZXMiLCJ0b0xvd2VyQ2FzZSIsIm1vZGVsIiwiZ2V0R2VuZXJhdGl2ZU1vZGVsIiwicHJvbXB0IiwicmVzdWx0IiwiZ2VuZXJhdGVDb250ZW50IiwicmVzcG9uc2VUZXh0IiwicmVzcG9uc2UiLCJqc29uVGV4dCIsImpzb25NYXRjaCIsImFuYWx5c2lzIiwiSlNPTiIsInBhcnNlIiwiTWF0aCIsIm1pbiIsImluY29tZVRyYW5zYWN0aW9ucyIsImZpbHRlciIsInQiLCJ0eXBlIiwicHVzaCIsIm1vbnRobHlEYXRhIiwibW9udGhseU1hcCIsIk1hcCIsImZvckVhY2giLCJ0eCIsImRhdGUiLCJEYXRlIiwibW9udGhLZXkiLCJnZXRGdWxsWWVhciIsIlN0cmluZyIsImdldE1vbnRoIiwicGFkU3RhcnQiLCJoYXMiLCJzZXQiLCJpbmNvbWUiLCJleHBlbnNlIiwic2F2aW5ncyIsIm1vbnRoRGF0YSIsImdldCIsImFtb3VudCIsImUiLCJBcnJheSIsImZyb20iLCJlbnRyaWVzIiwibWFwIiwibW9udGgiLCJkYXRhIiwic29ydCIsImEiLCJiIiwibG9jYWxlQ29tcGFyZSIsInBhcnNlRXJyb3IiLCJ0b2RheSIsInRvSVNPU3RyaW5nIiwic3BsaXQiLCJkZWZhdWx0QW5hbHlzaXMiLCJkZXNjcmlwdGlvbiIsImNhdGVnb3J5IiwibmFtZSIsInBlcmNlbnRhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/utils/gemini.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fdocuments%2Fupload&preferredRegion=&absolutePagePath=.%2Fsrc%2Fpages%2Fapi%2Fdocuments%2Fupload.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();